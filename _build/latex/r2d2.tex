%% Generated by Sphinx.
\def\sphinxdocclass{ujbook}
\documentclass[letterpaper,10pt,dvipdfmx,report]{sphinxmanual}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}

\PassOptionsToPackage{booktabs}{sphinx}
\PassOptionsToPackage{colorrows}{sphinx}

\PassOptionsToPackage{warn}{textcomp}


\usepackage{cmap}
\usepackage[T1]{fontenc}
\usepackage{amsmath,amssymb,amstext}




\usepackage{tgtermes}
\usepackage{tgheros}
\renewcommand{\ttdefault}{txtt}




\usepackage{sphinx}

\fvset{fontsize=auto}
\usepackage[dvipdfm]{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}
\usepackage{pxjahyper}


\usepackage{sphinxmessages}
\setcounter{tocdepth}{1}



\title{R2D2}
\date{2024年04月05日}
\release{1.2}
\author{Hideyuki Hotta}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{リリース}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{index::doc}}


\sphinxAtStartPar
このページは太陽のための輻射磁気流体コードR2D2 (RSST and Radiation for Deep Dynamics)
のマニュアルである。

\sphinxAtStartPar
\sphinxhref{https://github.com/hottahd/R2D2-manual/raw/master/\_build/latex/r2d2.pdf}{PDF版はこちら}

\sphinxAtStartPar
R2D2では、輻射磁気流体力学の方程式を中央差分と非線形の人工粘性を用いて高精度かつ安定に解く。R2D2では、太陽表面付近では現実的に輻射輸送を解き、太陽深部では微小擾乱を正確に解く手法を取ることで、太陽内部から表面までを一貫して解くことができる。

\noindent\sphinxincludegraphics[width=350\sphinxpxdimen]{{R2D2_logo_red}.png}

\sphinxstepscope


\chapter{R2D2を使い始めるには}
\label{\detokenize{start:r2d2}}\label{\detokenize{start::doc}}

\section{ディレクトリ構造の準備}
\label{\detokenize{start:id1}}
\sphinxAtStartPar
R2D2は公開していないので、各自 \sphinxcode{\sphinxupquote{R2D2.zip}} のようなファイルを受け取るはずである。研究を実施する際には、以下のようなディレクトリ構造を構成することを推奨する。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
project\PYGZus{}name/
           ├─ run/
           │    ├─ d001/
           │    ├─ d002/
           │    ├─ d003/
           │    ├─ ...
           │
           ├─ py/
           └─ idl/
\end{sphinxVerbatim}

\sphinxAtStartPar
pyには \sphinxhref{https://github.com/hottahd/R2D2\_py}{R2D2\_py} をクローンしてきたもの、idlには \sphinxhref{https://github.com/hottahd/R2D2\_idl}{R2D2\_idl} をクローンしてきたものを配置する。ここは名前が変わっても問題ない。python(py) とidlのどちらかを使えば解析は可能である(両方ダウンロードする必要はない)。

\sphinxAtStartPar
堀田から受け取った \sphinxcode{\sphinxupquote{R2D2.zip}} ファイルをそれぞれ \sphinxcode{\sphinxupquote{run/}} ディレクトリの \sphinxcode{\sphinxupquote{d001}} と名前を変えて配置する。新しい設定で計算する際は \sphinxcode{\sphinxupquote{d002}}, \sphinxcode{\sphinxupquote{d003}} とコピーしていくのが良いであろう。

\sphinxAtStartPar
R2D2ディレクトリの中は以下のようなディレクトリ構造を持つ。ファイル出力もプリプロセッサで制御しているため、指定によっては、 \sphinxcode{\sphinxupquote{data/}} 以下の構造は変更される。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
R2D2/
   ├─ F90\PYGZus{}deps.py
   ├─ Makefile
   ├─ README.md
   ├─ gen\PYGZus{}time.py
   ├─ copy\PYGZus{}caseid.py
   ├─ data/
   │     ├─ param/
   │     │      ├─ nd.dac
   │     │      ├─ back.dac
   │     │      ├─ params.dac
   │     │      └─ xyz.dac
   │     │
   │     ├─ qq/
   │     │   ├─ qq.dac.e
   │     │   ├─ qq.dac.o
   │     │   ├─ qq.dac.00000000
   │     │   ├─ qq.dac.00000001
   │     │   ├─ ...
   │     │
   │     ├─ tau/
   │     │   ├─ qq.dac.00000000
   │     │   ├─ qq.dac.00000001
   │     │   ├─ ...
   │     │
   │     ├─ remap/
   │     │      ├─ remap\PYGZus{}info.dac
   │     │      ├─ qq/
   │     │      │   ├─ qq.dac.00000000.00000000
   │     │      │   ├─ qq.dac.00000001.00000000
   │     │      │   ├─ ...
   │     │      │
   │     │      └─ vl/
   │     │          ├─ c.dac
   │     │          ├─ vla.dac.00000000
   │     │          ├─ vla.dac.00000001
   │     │          ├─ vla.dac.00000002
   │     │          ├─ ...
   │     │
   │     ├─ slice/
   │     │   ├─ qqx.dac.00000000.000000000
   │     │   ├─ ...
   │     │   ├─ qqy.dac.00000000.000000000
   │     │   ├─ ...
   │     │   ├─ qqz.dac.00000000.000000000
   │     │   ├─ ...
   │     │
   │     └─ time/
   │           ├─ mhd/
   │           │    ├─ t.dac.00000000
   │           │    ├─ t.dac.00000001
   │           │    ├─ ...
   │           │
   │           └─ tau/
   │                ├─ t.dac.00000000
   │                ├─ t.dac.00000001
   │                ├─ ...
   │
   ├─ input\PYGZus{}data/
   ├─ make/
   ├─ sh/
   └─ src/
        ├─ all/
        └─ include/
\end{sphinxVerbatim}

\sphinxAtStartPar
それぞれのファイル、ディレクトリの簡単な説明は以下に示す。
\begin{itemize}
\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{F90\_deps.py}}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{make/Makefile}} 生成のためのpythonスクリプト。Fortranコードの依存性を調べて、\sphinxcode{\sphinxupquote{make/R2D2.deps}} に出力する。新しいプログラムを作成したときは

\begin{sphinxVerbatim}[commandchars=\\\{\}]
python\PYG{+w}{ }F90\PYGZus{}deps.py
\end{sphinxVerbatim}

\sphinxAtStartPar
として \sphinxcode{\sphinxupquote{make/R2D2.deps}} を更新する。

\end{description}

\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{Makefile}}}
\sphinxAtStartPar
makeをするときに \sphinxcode{\sphinxupquote{make}} ディクレクトリに移動する為のファイル。編集する必要はない。編集すべき \sphinxcode{\sphinxupquote{Makefile}} は \sphinxcode{\sphinxupquote{make/Makefile}} に配置してある。

\end{description}

\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{README.md}}}
\sphinxAtStartPar
GitHubに表示する為の説明ファイル。情報が古くなっている可能性があるので、 \sphinxcode{\sphinxupquote{README.md}} を見るよりは、このウェブページの情報を参照されたい。

\end{description}

\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{gen\_time.py}}}
\sphinxAtStartPar
他のモデルから計算結果をもらったときにdataディレクトリや時間のファイルを生成する為のpythonスクリプト

\end{description}

\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{copy\_caseid.py}}}
\sphinxAtStartPar
ディレクトリを変えて続きの計算を行うためのスクリプト

\end{description}

\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{data/}}}
\sphinxAtStartPar
fortranプログラムを実行した後に、データが保存されるディレクトリ。fortranプログラムを実行すると自動的に生成される。
\begin{itemize}
\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{data/param/}}}
\sphinxAtStartPar
基本的な計算設定パラメタを出力する為のディレクトリ

\end{description}

\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{data/qq/}}}
\sphinxAtStartPar
チェックポイントのための３次元データを出力するためのディレクトリ

\end{description}

\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{data/remap/}}}
\sphinxAtStartPar
解析のためのリマッピングをしたあとのデータを格納するディレクトリ
\begin{itemize}
\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{data/remap/qq/}}}
\sphinxAtStartPar
計算データをリマッピングして扱いやすくした三次元データを格納するディレクトリ。単精度で出力。解析には主にこのデータを使う。

\end{description}

\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{data/remap/vl/}}}
\sphinxAtStartPar
計算実行中の解析データを格納するディレクトリ

\end{description}

\end{itemize}

\end{description}

\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{data/slice/}}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{slice\_def.F90}} で定義したスライスデータを格納するディレクトリ

\end{description}

\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{data/time/}}}
\sphinxAtStartPar
出力した時間を記録したファイルを格納するディレクトリ。3次元データの出力の時間を記録する \sphinxcode{\sphinxupquote{mhd}} と光学的厚さ一定の場所の出力の時間を記録する \sphinxcode{\sphinxupquote{tau}} のディレクトリがある。
\begin{itemize}
\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{data/time/mhd/}}}
\sphinxAtStartPar
MHD量のアウトプットの時間データ

\end{description}

\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{data/time/tau/}}}
\sphinxAtStartPar
光学的厚さ一定の面アウトプットの時間データ

\end{description}

\end{itemize}

\end{description}

\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{input\_data/}}}
\sphinxAtStartPar
プリプロセスで用意したデータの格納ディレクトリ

\end{description}

\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{make/}}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Makefile}} が配置してあるディレクトリ。 \sphinxcode{\sphinxupquote{make}} によって生成されたファイルもここに格納される

\end{description}

\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{sh/}}}
\sphinxAtStartPar
スーパーコンピュータでのジョブ投入のためのシェルスクリプトを格納するディレクトリ

\end{description}

\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{src/}}}
\sphinxAtStartPar
ソースファイルを格納するディレクトリ
\begin{itemize}
\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{all/}}}
\sphinxAtStartPar
メインのソースファイルを格納するディレクトリ

\end{description}

\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{include/}}}
\sphinxAtStartPar
includeファイルを格納するディレクトリ

\end{description}

\end{itemize}

\end{description}

\end{itemize}

\end{description}

\end{itemize}


\section{コンパイル}
\label{\detokenize{start:id2}}
\sphinxAtStartPar
コンパイルはR2D2のディクレトリで

\begin{sphinxVerbatim}[commandchars=\\\{\}]
make
\end{sphinxVerbatim}

\sphinxAtStartPar
とするのみである。使う計算機によって設定が違うので \sphinxcode{\sphinxupquote{make/Makfile}} を編集する必要がある。
このファイルの1行目に

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nv}{SERVER}\PYG{o}{=}FUGAKU
\end{sphinxVerbatim}

\sphinxAtStartPar
などと書いてある部分がある。計算機に応じてこの部分を書き換える。
それぞれ以下のような対応になっている。すでに使用できない計算機については説明しない。
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{XC}}: CfCA XC50

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{FX}}: 名大不老

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{FUGAKU}}: 富岳

\end{itemize}

\sphinxAtStartPar
以下、堀田の個人環境なので、使用は推奨されない。どうしても個人の環境で使いたい時は堀田まで相談されたい。
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{LOCAL}}: UbuntuのGCC

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{LOCAL\_ifort}}: UbuntuのIntel fortran ifort

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{MAC}}: MacのGCC

\end{itemize}


\section{初期条件}
\label{\detokenize{start:id3}}
\sphinxAtStartPar
初期条件は、 \sphinxcode{\sphinxupquote{src/all/model\_init.F90}} で設定している。基本的な光球計算などは、鉛直速度にランダムな値を入れて計算を始めている。


\section{追加条件}
\label{\detokenize{start:id4}}
\sphinxAtStartPar
ある程度計算を行った後に、続きの計算として少し設定を変えたい場合の手続きを示す。
例えば、磁場なしの熱対流計算を行った後に、磁場を加える場合などに有効である。

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{run/d001}} での計算を \sphinxcode{\sphinxupquote{run/d002}} に移す場合について説明する。
\sphinxcode{\sphinxupquote{run/d001}} の下に \sphinxcode{\sphinxupquote{copy\_caseid.py}} というスクリプトがあるのでそれを実行する(なければ堀田からもらう)

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{python} \PYG{n}{copy\PYGZus{}caseid}\PYG{o}{.}\PYG{n}{py}
\end{sphinxVerbatim}

\sphinxAtStartPar
実行すると

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Q1}\PYG{o}{.} \PYG{n}{Input} \PYG{n}{destination} \PYG{n}{caseid} \PYG{k}{for} \PYG{n}{copy}\PYG{p}{,} \PYG{n}{like} \PYG{n}{d001}
\end{sphinxVerbatim}

\sphinxAtStartPar
と質問されるので、データを移す先のcaseidを \sphinxcode{\sphinxupquote{d002}} などと入力する。

\sphinxAtStartPar
次に

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{Q2}\PYG{o}{.} \PYG{n}{Input} \PYG{n}{time} \PYG{n}{step} \PYG{k}{for} \PYG{n}{copy}\PYG{p}{,} \PYG{n}{like} \PYG{l+m+mi}{10} \PYG{o+ow}{or} \PYG{n}{end}
\end{sphinxVerbatim}

\sphinxAtStartPar
と質問されるので、移動したいデータの時間ステップを \sphinxcode{\sphinxupquote{10}} などと入力する。
チェックポイントのデータはデフォルトでは、10回に一回しか出力していないので注意すること。

\sphinxAtStartPar
また、現在行った計算の最後の時間ステップのデータを移動したい時は \sphinxcode{\sphinxupquote{10}} などの代わりに
\sphinxcode{\sphinxupquote{end}} と入力する。
するとプログラム・データのコピーが始まる。すでに移動先(今回場合は \sphinxcode{\sphinxupquote{d002}} に \sphinxcode{\sphinxupquote{data}} ディレクトリがある場合は、コピーが始まらないので、削除してからコピーすること)。

\sphinxAtStartPar
また、コピーが終わると移動先の \sphinxcode{\sphinxupquote{data/cont\_log.txt}} に元データの情報が記載してある。

\sphinxAtStartPar
データをコピーした後に、磁場などを付け加えたい時は \sphinxcode{\sphinxupquote{src/all/model\_add.F90}} を編集する.

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{do }\PYG{n}{k}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{nzg}
\PYG{k}{do }\PYG{n}{j}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{nyg}
\PYG{k}{do }\PYG{n}{i}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{nxg}
\PYG{+w}{   }\PYG{n}{qq}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n}{i}\PYG{p}{,}\PYG{n}{j}\PYG{p}{,}\PYG{n}{k}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{qq}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{n}{i}\PYG{p}{,}\PYG{n}{j}\PYG{p}{,}\PYG{n}{k}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{l+m+mi}{20}\PYG{l+m+mf}{0.d0}
\PYG{+w}{   }\PYG{n}{qq}\PYG{p}{(}\PYG{l+m+mi}{6}\PYG{p}{,}\PYG{n}{i}\PYG{p}{,}\PYG{n}{j}\PYG{p}{,}\PYG{n}{k}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{qq}\PYG{p}{(}\PYG{l+m+mi}{6}\PYG{p}{,}\PYG{n}{i}\PYG{p}{,}\PYG{n}{j}\PYG{p}{,}\PYG{n}{k}\PYG{p}{)}
\PYG{+w}{   }\PYG{n}{qq}\PYG{p}{(}\PYG{l+m+mi}{7}\PYG{p}{,}\PYG{n}{i}\PYG{p}{,}\PYG{n}{j}\PYG{p}{,}\PYG{n}{k}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{qq}\PYG{p}{(}\PYG{l+m+mi}{7}\PYG{p}{,}\PYG{n}{i}\PYG{p}{,}\PYG{n}{j}\PYG{p}{,}\PYG{n}{k}\PYG{p}{)}
\PYG{k}{enddo}
\PYG{k}{enddo}
\PYG{k}{enddo}
\end{sphinxVerbatim}

\sphinxAtStartPar
などと書いてある。この例では鉛直磁場に200 Gが足されている。次に \sphinxcode{\sphinxupquote{src/all/io.F90}} を編集する。中ほどに

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c}{! add something}
\PYG{n}{time00}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{0.d0}
\PYG{k}{if}\PYG{p}{(}\PYG{n}{ns}\PYG{+w}{ }\PYG{o}{==}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{+w}{ }\PYG{p}{.}\PYG{n+nb}{and}\PYG{p}{.}\PYG{+w}{ }\PYG{n}{nd}\PYG{+w}{ }\PYG{o}{==}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{+w}{ }\PYG{k}{then}
\PYG{c}{!if(ns == 0) then}
\PYG{+w}{   }\PYG{c}{!call model\PYGZus{}sunspot}
\PYG{+w}{   }\PYG{c}{!call model\PYGZus{}fe\PYGZus{}pff}
\PYG{+w}{   }\PYG{c}{!call model\PYGZus{}add}
\PYG{k}{endif}
\end{sphinxVerbatim}

\sphinxAtStartPar
と書かれている部分があるので、 \sphinxcode{\sphinxupquote{call model\_add}} の部分のコメントアウトを外す。 \sphinxcode{\sphinxupquote{ns}} は現在の計算のステップ数(続きの計算では引き継がれない)、 \sphinxcode{\sphinxupquote{nd}} は計算全体のデータアウトプット回数(続きの計算で引き継がれる)。この二つの変数が0の時は、計算の一番はじめもしくは、データを引き継いだ時のみなので、その時のみ追加条件が発動する。


\section{スーパーコンピュータでのシェルスクリプト}
\label{\detokenize{start:id5}}
\sphinxAtStartPar
いくつかのスーパーコンピュータでジョブを投入するためのシェルスクリプトも \sphinxcode{\sphinxupquote{sh}} ディレクトリに用意している。
使用コア数などを変えたい時は、それぞれのスーパーコンピュータの使用説明書などを参照すること。
今後使うことのできるものだけをあげる。
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{fx.sh}} : 名大FX100

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{ofp.sh}} : Oakforest\sphinxhyphen{}PACS

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{xc.sh}} : CfCA XC50

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{fg.sh}} : 富岳

\end{itemize}


\section{初期条件データを受け取った場合}
\label{\detokenize{start:id6}}
\sphinxAtStartPar
熱対流が統計的定常に達するまでは非常に時間がかかるために、この計算が非常に困難になる。そのため、堀田がデータを提供することがある。堀田は \sphinxcode{\sphinxupquote{data}} ディレクトリを丸ごと提供する。

\sphinxAtStartPar
このディレクトリに \sphinxcode{\sphinxupquote{cont\_log.txt}} というファイルがあるので、そこに示されている計算設定の情報を見て同じようになるように計算を設定する。

\sphinxAtStartPar
このディレクトリを書く実行のディレクトリの配下におき、実行すると続きの計算が始まる。

\sphinxAtStartPar
最終更新日：2024年04月05日

\sphinxstepscope


\chapter{R2D2を使うための環境設定}
\label{\detokenize{environment:r2d2}}\label{\detokenize{environment::doc}}
\sphinxAtStartPar
R2D2コードを使って計算するだけならば任意のfortranコンパイラ, FFTW, MPIのみがあれば良い。
Pythonコードを使って解析する場合は、いくつかのモジュールが必要なので、そのインストールの方法もここで説明する。


\section{Fortranコードの環境設定}
\label{\detokenize{environment:fortran}}

\subsection{Mac}
\label{\detokenize{environment:mac}}
\sphinxAtStartPar
Homebrewを用いて、必要なコンパイラ・ライブラリをインストールすることを推奨している。
コンパイラとFFTWのインクルードファイルとライブラリの位置だけ指定すれば良いので、
任意の方法でインストールして構わない。Homebrew以外を用いる場合は、便宜make/Makefileを編集すること。

\sphinxAtStartPar
Homebrewのインストール

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{/}\PYG{n}{usr}\PYG{o}{/}\PYG{n+nb}{bin}\PYG{o}{/}\PYG{n}{ruby} \PYG{o}{\PYGZhy{}}\PYG{n}{e} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZdl{}(curl \PYGZhy{}fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)}\PYG{l+s+s2}{\PYGZdq{}}
\end{sphinxVerbatim}

\sphinxAtStartPar
gfortranのインストール

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{brew} \PYG{n}{install} \PYG{n}{gcc}
\end{sphinxVerbatim}

\sphinxAtStartPar
OpenMPIのインストール

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{brew} \PYG{n}{install} \PYG{n}{openmpi}
\end{sphinxVerbatim}

\sphinxAtStartPar
FFTWのインストール

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{brew} \PYG{n}{install} \PYG{n}{fftw}
\end{sphinxVerbatim}


\subsection{Linux (Ubuntu 22.04)}
\label{\detokenize{environment:linux-ubuntu-22-04}}
\sphinxAtStartPar
ここでは、Ubuntu 22.04の場合のみを説明する。

\sphinxAtStartPar
gfortranのインストール

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{sudo} \PYG{n}{apt}\PYG{o}{\PYGZhy{}}\PYG{n}{get} \PYG{n}{install} \PYG{n}{gfortran}
\end{sphinxVerbatim}

\sphinxAtStartPar
OpenMPIのインストール

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{sudo} \PYG{n}{apt}\PYG{o}{\PYGZhy{}}\PYG{n}{get} \PYG{n}{install} \PYG{n}{openmpi}\PYG{o}{\PYGZhy{}}\PYG{n}{doc} \PYG{n}{openmpi}\PYG{o}{\PYGZhy{}}\PYG{n+nb}{bin} \PYG{n}{libopenmpi}\PYG{o}{\PYGZhy{}}\PYG{n}{dev}
\end{sphinxVerbatim}

\sphinxAtStartPar
FFTWのインストール

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{sudo} \PYG{n}{apt}\PYG{o}{\PYGZhy{}}\PYG{n}{get} \PYG{n}{install} \PYG{n}{libfftw3}\PYG{o}{\PYGZhy{}}\PYG{n}{dev}
\end{sphinxVerbatim}


\section{Pythonコードの環境設定}
\label{\detokenize{environment:python}}
\sphinxAtStartPar
Anacondaをインストールし、以下に示すモジュール群をインストールする。
MacとLinuxで共通する部分が多いのでまとめて説明を記す。

\sphinxAtStartPar
\sphinxhref{https://www.anaconda.com/}{Anacondaのウェブサイト} から対応するインストーラーをダウンロードする。
\begin{itemize}
\item {} \begin{description}
\sphinxlineitem{Mac}
\sphinxAtStartPar
dmgファイルをダウンロードして、インストール。インストールされるPATHが変わることが多いが、探してPATHを通す。 \sphinxcode{\sphinxupquote{/anaconda/bin}} や \sphinxcode{\sphinxupquote{\textasciitilde{}/opt/anaconda/bin}} など

\end{description}

\item {} \begin{description}
\sphinxlineitem{Linux}
\sphinxAtStartPar
ダウンロードしてきたシェルスクリプトファイルのあるディレクトリで
.. code:

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{bash} \PYG{o}{\PYGZti{}}\PYG{o}{/}\PYG{n}{Anaconda}\PYG{o}{*}\PYG{o}{*}\PYG{o}{*}\PYG{o}{.}\PYG{n}{sh}
\end{sphinxVerbatim}

\sphinxAtStartPar
インストールするディレクトリは \sphinxcode{\sphinxupquote{/ホームディレクトリ/anaconda3}} とする。
\sphinxcode{\sphinxupquote{/ホームディレクトリ/anaconda3}} にPATHを通す。
スパコンのログインノードなどでもインストール方法は共通である。

\end{description}

\end{itemize}


\subsection{ipythonの初期設定}
\label{\detokenize{environment:ipython}}
\sphinxAtStartPar
以下は必須ではないが、ipythonを使う時の初期設定ファイルである。
\sphinxcode{\sphinxupquote{\textasciitilde{}/.ipython/profile\_default/startup/00\_first.py}}
というファイルを作りそこに以下のように記す。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{sys}\PYG{o}{,} \PYG{n+nn}{os}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{import} \PYG{n+nn}{scipy} \PYG{k}{as} \PYG{n+nn}{sp}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{from} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k+kn}{import} \PYG{n}{pcolormesh}\PYG{p}{,}\PYG{n}{plot}\PYG{p}{,}\PYG{n}{clf}\PYG{p}{,}\PYG{n}{close}
\PYG{k+kn}{from} \PYG{n+nn}{numpy} \PYG{k+kn}{import} \PYG{n}{sin}\PYG{p}{,}\PYG{n}{cos}\PYG{p}{,}\PYG{n}{tan}\PYG{p}{,}\PYG{n}{arcsin}\PYG{p}{,}\PYG{n}{arccos}\PYG{p}{,}\PYG{n}{arctan}\PYG{p}{,}\PYG{n}{exp}\PYG{p}{,}\PYG{n}{log}\PYG{p}{,}\PYG{n}{log2}\PYG{p}{,}\PYG{n}{log10}\PYG{p}{,}\PYG{n}{mod}\PYG{p}{,}\PYG{n}{sqrt}\PYG{p}{,}\PYG{n}{absolute}\PYG{p}{,}\PYG{n}{sinh}\PYG{p}{,}\PYG{n}{cosh}\PYG{p}{,}\PYG{n}{tanh}\PYG{p}{,}\PYG{n}{pi}\PYG{p}{,}\PYG{n}{arange}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{ion}\PYG{p}{(}\PYG{p}{)}
\PYG{k+kn}{from} \PYG{n+nn}{IPython}\PYG{n+nn}{.}\PYG{n+nn}{core}\PYG{n+nn}{.}\PYG{n+nn}{magic} \PYG{k+kn}{import} \PYG{n}{register\PYGZus{}line\PYGZus{}magic}
\PYG{n+nd}{@register\PYGZus{}line\PYGZus{}magic}
\PYG{k}{def} \PYG{n+nf}{r}\PYG{p}{(}\PYG{n}{line}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{get\PYGZus{}ipython}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{run\PYGZus{}line\PYGZus{}magic}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{run}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ \PYGZhy{}i }\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n}{line}\PYG{p}{)}
\PYG{k}{del} \PYG{n}{r}
\end{sphinxVerbatim}

\sphinxAtStartPar
最後に記した設定によって、

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{r} \PYG{p}{(}\PYG{n}{Pythonスクリプト名}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
とするだけで、スクリプトを実行できるようになる。


\subsection{Googleスプレッドシート利用}
\label{\detokenize{environment:google}}
\sphinxAtStartPar
計算設定などをGoogleスプレッドシートにまとめておくと便利である。
R2D2では、Pythonから直接Googleスプレッドシートに送信する方法を提供しているので、利用したい方は検討されたい。

\sphinxAtStartPar
手順については、 \sphinxhref{https://qiita.com/akabei/items/0eac37cb852ad476c6b9}{こちら} を参考にしたが、少し手順が違うのでこのページでも解説する。

\sphinxAtStartPar
まずは関連するモジュールのインストール。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
pip\PYG{+w}{ }install\PYG{+w}{ }gspread
pip\PYG{+w}{ }install\PYG{+w}{ }oauth2client
\end{sphinxVerbatim}

\sphinxAtStartPar
プロキシなどの影響でpipが使えない時は以下のようにする

\sphinxAtStartPar
gspreadのインストール

\begin{sphinxVerbatim}[commandchars=\\\{\}]
git\PYG{+w}{ }clone\PYG{+w}{ }git@github.com:burnash/gspread.git
\PYG{n+nb}{cd}\PYG{+w}{ }gspread
ipython\PYG{+w}{ }setup.py\PYG{+w}{ }install
\end{sphinxVerbatim}

\sphinxAtStartPar
oauth2clientのインストール

\begin{sphinxVerbatim}[commandchars=\\\{\}]
git\PYG{+w}{ }clone\PYG{+w}{ }git@github.com:googleapis/oauth2client.git
\PYG{n+nb}{cd}\PYG{+w}{ }oauth2client
ipython\PYG{+w}{ }setup.py\PYG{+w}{ }install
\end{sphinxVerbatim}


\subsubsection{プロジェクト作成}
\label{\detokenize{environment:id2}}
\sphinxAtStartPar
ウェブブラウザで \sphinxurl{https://console.developers.google.com/cloud-resource-manager?pli=1} にアクセス。

\noindent\sphinxincludegraphics[width=350\sphinxpxdimen]{{gen_project1}.png}

\sphinxAtStartPar
「プロジェクトを作成」として、プロジェクトを作成

\noindent\sphinxincludegraphics[width=400\sphinxpxdimen]{{gen_project2}.png}

\sphinxAtStartPar
プロジェクト名はR2D2, 場所は組織なしとする。


\subsubsection{API有効化}
\label{\detokenize{environment:api}}
\noindent\sphinxincludegraphics[width=400\sphinxpxdimen]{{google_drive1}.png}

\sphinxAtStartPar
次に検索窓にGoogle Driveと打ち込んで、Google DriveのAPIを検索

\noindent\sphinxincludegraphics[width=400\sphinxpxdimen]{{google_drive2}.png}

\sphinxAtStartPar
Google Drive APIを有効にする。

\noindent\sphinxincludegraphics[width=400\sphinxpxdimen]{{google_sheet1}.png}

\sphinxAtStartPar
同様にGoogle Sheetsと検索

\noindent\sphinxincludegraphics[width=400\sphinxpxdimen]{{google_sheet2}.png}

\sphinxAtStartPar
Google Sheets APIを有効化


\subsubsection{サービスアカウント作成}
\label{\detokenize{environment:id3}}
\noindent\sphinxincludegraphics[width=400\sphinxpxdimen]{{service_account1}.png}

\sphinxAtStartPar
Google APIロゴ \(\rightarrow\) 認証情報 \(\rightarrow\) サービスアカウントとたどる。

\noindent\sphinxincludegraphics[width=400\sphinxpxdimen]{{service_account2}.png}

\sphinxAtStartPar
サービスアカウント名はR2D2とする

\noindent\sphinxincludegraphics[width=400\sphinxpxdimen]{{service_account3}.png}

\sphinxAtStartPar
役割は編集者を選択

\noindent\sphinxincludegraphics[width=400\sphinxpxdimen]{{service_account4}.png}

\sphinxAtStartPar
キーの生成ではJSONを選択し、キーを生成する。
ダウンロードしたファイルは、使用する計算機のホームディレクトリにjsonというディレクトリを作成し、その下に配置する。そのディレクトリには、このjsonファイル以外には何も置かないこと。


\subsubsection{スプレッドシート作成}
\label{\detokenize{environment:id4}}
\sphinxAtStartPar
以下のウェブサイトからGoogleスプレッドシートを作成
\sphinxurl{https://docs.google.com/spreadsheets/create}

\sphinxAtStartPar
名前はプロジェクト名とする。R2D2では、pyディレクトリの上のディレクトリ名を読みそれをスプレッドシートの名前として情報を送るので、ディレクトリと同じ名前にする。

\noindent\sphinxincludegraphics[width=400\sphinxpxdimen]{{spread_sheet1}.png}

\sphinxAtStartPar
講習会ではR2D2としておく。

\noindent\sphinxincludegraphics[width=400\sphinxpxdimen]{{spread_sheet2}.png}

\sphinxAtStartPar
共有をクリックし、ダウンロードしたjsonファイルの中のclient\_email行のEメールアドレスをコピーして、貼り付け。ここまでで、R2D2からGoogleスプレッドシートにアクセスできるようになる。


\section{IDLコードの環境設定}
\label{\detokenize{environment:idl}}
\sphinxAtStartPar
システムにIDLをインストールすれば、それのみで使える。ここでは説明しない。

\sphinxAtStartPar
最終更新日：2024年04月05日

\sphinxstepscope


\chapter{典型的計算例}
\label{\detokenize{typical_case:id1}}\label{\detokenize{typical_case::doc}}
\sphinxAtStartPar
ここでは、典型的計算設定について紹介する。


\section{デカルト座標}
\label{\detokenize{typical_case:id2}}

\subsection{小規模局所光球計算}
\label{\detokenize{typical_case:id3}}
\sphinxAtStartPar
\sphinxhref{https://ui.adsabs.harvard.edu/abs/2005A\%26A...429..335V/abstract}{Vögler et al., 2005} などで行われている小規模局所光球計算の設定を説明する。
\begin{itemize}
\item {} \begin{description}
\sphinxlineitem{Makefileのオプション}
\sphinxAtStartPar
指定するオプションは
光球のみ一様グリッドで計算するので, 複数方向輻射輸送で計算する。指定するオプションは
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{PPC := \sphinxhyphen{}Dremap\_2d\_assign}}

\end{itemize}

\end{description}

\item {} \begin{description}
\sphinxlineitem{計算領域・解像度}
\sphinxAtStartPar
計算領域は鉛直方向(R2D2ではx方向)にrsun から700 km上から5.444 Mm下までをとる。水平方向(R2D2ではyとz方向)には、6.144 Mmずつとる。

\sphinxAtStartPar
太陽光球を計算するときは、鉛直方向には少なくとも48 km, 水平方向には少なくとも192 kmの格子間隔が必要である。ここでは各方向に48 kmの格子点間隔をとることにして、各方向に128グリッドづつ格子点を用意する。ここではMPIプロセスを2×2×2プロセス使う例を示す。これらの設定は \sphinxcode{\sphinxupquote{src/all/geometry\_def.F90}} を編集。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kt}{integer}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{private}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{nx0}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{64}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ny0}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{64}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nz0}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{64}
\PYG{k+kt}{integer}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ix0}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{jx0}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{kx0}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{2}

\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}

\PYG{c+cp}{\PYGZsh{}ifdef deep}
\PYG{+w}{    }\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{ignore}\PYG{+w}{ }\PYG{n}{this}\PYG{p}{)}
\PYG{c+cp}{\PYGZsh{}else}
\PYG{+w}{    }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{xmax}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{rsun}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{l+m+mf}{0.7d8}
\PYG{+w}{    }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{xmin}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{rsun}\PYG{+w}{ }\PYG{o}{\PYGZhy{}}\PYG{+w}{ }\PYG{l+m+mf}{5.444d8}
\PYG{c+cp}{\PYGZsh{}endif}

\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}

\PYG{c+cp}{\PYGZsh{}ifndef ideal}
\PYG{+w}{    }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ymin}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{0.d0}
\PYG{+w}{    }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ymax}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{6.144d0}
\PYG{+w}{    }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ymax}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{0.d0}
\PYG{+w}{    }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ymax}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{6.144d0}
\PYG{c+cp}{\PYGZsh{}endif}
\end{sphinxVerbatim}

\sphinxAtStartPar
と設定する。念のために

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kt}{integer}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{xdcheck}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{2}
\PYG{k+kt}{integer}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ydcheck}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{2}
\PYG{k+kt}{integer}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{zdcheck}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{2}

\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}

\PYG{k+kt}{integer}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{iper}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{jper}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{kper}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}
\end{sphinxVerbatim}

\sphinxAtStartPar
となっているかチェックする。全て \sphinxcode{\sphinxupquote{xdcheck}} などは2に設定してあると3次元計算となる。\sphinxcode{\sphinxupquote{iper}} はそれぞれの方向に周期境界条件を使うかのフラグである。

\end{description}

\item {} \begin{description}
\sphinxlineitem{音速抑制法}
\sphinxAtStartPar
光球のみ計算の時は、音速抑制法を使う必要は無いので、音速抑制率を常に1に設定する。
\sphinxcode{\sphinxupquote{src/all/background\_init.F90}} を編集。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZsh{}ifdef ideal}
\PYG{+w}{    }\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{ignore}\PYG{+w}{ }\PYG{n}{this}\PYG{p}{)}
\PYG{c+cp}{\PYGZsh{}else}

\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}

\PYG{k}{do }\PYG{n}{i}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{ix00}
\PYG{+w}{    }\PYG{c}{!xi00(i) = max(1.d0,160.d0*(ro00(i)/rob))**(1.d0/3.d0)*sqrt(dprdro(i)/dprdrob)}
\PYG{+w}{    }\PYG{n}{xi00}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{1.d0}

\PYG{+w}{    }\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}
\PYG{k}{end }\PYG{k}{do}

\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}

\PYG{c+cp}{\PYGZsh{}endif}
\end{sphinxVerbatim}

\sphinxAtStartPar
と設定する。

\end{description}

\item {} \begin{description}
\sphinxlineitem{境界条件}
\sphinxAtStartPar
水平方向は周期境界を用いるので、鉛直方向の境界条件のみを設定すれば良い。
磁場の上部境界条件はポテンシャル磁場の境界条件を用いる。他の設定はVöglerの論文を参照。
\sphinxcode{\sphinxupquote{src/all/bc\_all.F90}} で設定している。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZsh{}ifdef ideal}
\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{ignore}\PYG{+w}{ }\PYG{n}{this}\PYG{p}{)}
\PYG{c+cp}{\PYGZsh{}else}

\PYG{c+cp}{\PYGZsh{}ifdef deep}
\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{ignore}\PYG{+w}{ }\PYG{n}{this}\PYG{p}{)}
\PYG{c+cp}{\PYGZsh{}else}
\PYG{+w}{    }\PYG{k}{call }\PYG{n}{bcx}\PYG{p}{(}\PYG{n}{qq}\PYG{p}{)}
\PYG{+w}{    }\PYG{c}{!call bcx\PYGZus{}whole(qq)}
\PYG{c+cp}{\PYGZsh{}endif}
\end{sphinxVerbatim}

\sphinxAtStartPar
とする。 \sphinxcode{\sphinxupquote{bcx(qq)}} が実行されるようにする。
また、念のため

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{call }\PYG{n}{bc\PYGZus{}potential}\PYG{p}{(}\PYG{n}{qq}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
がコメントアウトされていないかチェックする。

\end{description}

\item {} \begin{description}
\sphinxlineitem{輻射輸送}
\sphinxAtStartPar
輻射輸送は複数本の光線を解くのが良い。Makefileで \sphinxcode{\sphinxupquote{PPC: = \sphinxhyphen{}Done\_ray}} を設定しないようにする。

\end{description}

\item {} \begin{description}
\sphinxlineitem{初期条件}
\sphinxAtStartPar
初期条件は、鉛直方向速度(vx)にランダムな微小速度を与えている。プラージュ領域を計算したい場合は
\sphinxcode{\sphinxupquote{model\_init.F90}} で

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{bx}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{10}\PYG{l+m+mf}{0.d0}
\end{sphinxVerbatim}

\sphinxAtStartPar
とすれば良い.

\end{description}

\item {} \begin{description}
\sphinxlineitem{出力アウトプット}
\sphinxAtStartPar
ここは本当は完全に自由だが、データの出力の設定である。粒状斑の動きを詳しく見ようと思ったら30秒ほどの時間ケーデンスで出力するのが良い。
\sphinxcode{\sphinxupquote{main.F90}} を編集。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dtout}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{3}\PYG{l+m+mf}{0.d0}
\PYG{n}{ifac}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{1.d0}
\end{sphinxVerbatim}

\end{description}

\item {} \begin{description}
\sphinxlineitem{その他注意事項}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{model\_def.F90}} で \sphinxcode{\sphinxupquote{remap\_calc.F90}} で出力するスライスの位置を決定している。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kt}{integer}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{jc}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{ny}\PYG{o}{*}\PYG{n}{jx0}\PYG{o}{/}\PYG{l+m+mi}{2}
\PYG{k+kt}{integer}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{kc}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{nz}\PYG{o}{*}\PYG{n}{kx0}\PYG{o}{/}\PYG{l+m+mi}{2}
\end{sphinxVerbatim}

\sphinxAtStartPar
と領域の真ん中を出力することにしているが、状況によって違う場所が出力されている場合がある。もし変なことが起こったらここをチェックしてみると良い。

\sphinxAtStartPar
また、 \sphinxcode{\sphinxupquote{io.F90}} の中程に計算の途中に磁場などを追加する設定がある。ここに何か書いてあると初期条件に足してしまうので、add something で検索して \sphinxcode{\sphinxupquote{call model\_*}} ({\color{red}\bfseries{}*}は任意)のところはコメントアウトするように。

\end{description}

\item {} \begin{description}
\sphinxlineitem{計算結果}
\sphinxAtStartPar
以下のような計算が得られる。

\noindent\sphinxincludegraphics[width=500\sphinxpxdimen]{{photosphere}.png}

\end{description}

\end{itemize}


\subsection{中規模黒点計算}
\label{\detokenize{typical_case:id6}}
\sphinxAtStartPar
\sphinxhref{https://ui.adsabs.harvard.edu/abs/2012ApJ...750...62R/abstract}{Rempel, 2012} で行われている中規模光球計算の設定を説明する。
\begin{itemize}
\item {} \begin{description}
\sphinxlineitem{Makefileのオプション}
\sphinxAtStartPar
光球のみ一様グリッドで計算するので, :code:{\color{red}\bfseries{}\textasciigrave{}}PPC:= \sphinxhyphen{}Ddeep\textasciigrave{}を設定していないかチェック。

\end{description}

\item {} \begin{description}
\sphinxlineitem{計算領域・解像度}
\sphinxAtStartPar
計算領域は鉛直方向(R2D2ではx方向)にrsun から700 km上から5.444 Mm下までをとる。水平方向(R2D2ではyとz方向)には、49.152 Mmずつとる。

\sphinxAtStartPar
太陽光球を計算するときは、鉛直方向には少なくとも48 km, 水平方向には少なくとも192 kmの格子間隔が必要である。ここでは鉛直方向に48 km、水平方向に96 kmの格子点間隔をとることにして、鉛直方向に128グリッド、水平方向に512グリッドづつ格子点を用意する。ここではMPIプロセスを2×4×4プロセス使う例を示す。これらの設定は \sphinxcode{\sphinxupquote{src/all/geometry\_def.F90}} を編集。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZsh{}ifdef deep}
\PYG{+w}{    }\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{ignore}\PYG{+w}{ }\PYG{n}{this}\PYG{p}{)}
\PYG{c+cp}{\PYGZsh{}elif ideal}
\PYG{+w}{    }\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{ignore}\PYG{+w}{ }\PYG{n}{this}\PYG{p}{)}
\PYG{c+cp}{\PYGZsh{}else}
\PYG{+w}{    }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{xmax}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{rsun}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{l+m+mf}{0.7d8}
\PYG{+w}{    }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{xmin}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{rsun}\PYG{+w}{ }\PYG{o}{\PYGZhy{}}\PYG{+w}{ }\PYG{l+m+mf}{5.444d8}
\PYG{c+cp}{\PYGZsh{}endif}

\PYG{c+cp}{\PYGZsh{}ifndef ideal}
\PYG{+w}{    }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ymin}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{0.d0}
\PYG{+w}{    }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ymax}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{4}\PYG{l+m+mf}{9.152d8}
\PYG{+w}{    }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ymax}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{0.d0}
\PYG{+w}{    }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ymax}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{4}\PYG{l+m+mf}{9.152d8}
\PYG{c+cp}{\PYGZsh{}endif}

\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}
\PYG{k+kt}{integer}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{private}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{nx0}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{64}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ny0}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{128}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nz0}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{128}

\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}
\PYG{k+kt}{integer}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ix0}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{jx0}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{4}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{kx0}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{4}
\end{sphinxVerbatim}

\sphinxAtStartPar
と設定する。念のために

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kt}{integer}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{xdcheck}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{2}
\PYG{k+kt}{integer}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ydcheck}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{2}
\PYG{k+kt}{integer}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{zdcheck}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{2}

\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}

\PYG{k+kt}{integer}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{iper}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{jper}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{kper}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}
\end{sphinxVerbatim}

\sphinxAtStartPar
となっているかチェックする。全て \sphinxcode{\sphinxupquote{xdcheck}} などは2に設定してあると3次元計算となる。\sphinxcode{\sphinxupquote{iper}} はそれぞれの方向に周期境界条件を使うかのフラグである。

\end{description}

\item {} \begin{description}
\sphinxlineitem{音速抑制法}
\sphinxAtStartPar
光球のみ計算の時は、音速抑制法を使う必要は無いので、音速抑制率を常に1に設定する。
\sphinxcode{\sphinxupquote{src/all/background\_init.F90}} を編集。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZsh{}ifdef ideal}
\PYG{+w}{    }\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{ignore}\PYG{+w}{ }\PYG{n}{this}\PYG{p}{)}
\PYG{c+cp}{\PYGZsh{}else}

\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}

\PYG{k}{do }\PYG{n}{i}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{ix00}
\PYG{+w}{    }\PYG{c}{!xi00(i) = max(1.d0,160.d0*(ro00(i)/rob))**(1.d0/3.d0)*sqrt(dprdro(i)/dprdrob)}
\PYG{+w}{    }\PYG{n}{xi00}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{1.d0}

\PYG{+w}{    }\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}
\PYG{k}{end }\PYG{k}{do}

\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}

\PYG{c+cp}{\PYGZsh{}endif}
\end{sphinxVerbatim}

\sphinxAtStartPar
と設定する。

\end{description}

\item {} \begin{description}
\sphinxlineitem{境界条件}
\sphinxAtStartPar
水平方向は周期境界を用いるので、鉛直方向の境界条件のみを設定すれば良い。
磁場の上部境界条件はポテンシャル磁場の境界条件を用いる。他の設定はRempelの論文を参照。
\sphinxcode{\sphinxupquote{src/all/bc\_all.F90}} で設定している。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZsh{}ifdef ideal}
\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{ignore}\PYG{+w}{ }\PYG{n}{this}\PYG{p}{)}
\PYG{c+cp}{\PYGZsh{}else}

\PYG{c+cp}{\PYGZsh{}ifdef deep}
\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{ignore}\PYG{+w}{ }\PYG{n}{this}\PYG{p}{)}
\PYG{c+cp}{\PYGZsh{}else}
\PYG{+w}{    }\PYG{k}{call }\PYG{n}{bcx\PYGZus{}sunspot}\PYG{p}{(}\PYG{n}{qq}\PYG{p}{)}
\PYG{+w}{    }\PYG{c}{!call bcx(qq)}
\PYG{+w}{    }\PYG{c}{!call bcx\PYGZus{}whole(qq)}
\PYG{c+cp}{\PYGZsh{}endif}
\end{sphinxVerbatim}

\sphinxAtStartPar
とする。 \sphinxcode{\sphinxupquote{bcx\_sunspot(qq)}} が実行されるようにする。
また、念のため

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{call }\PYG{n}{bc\PYGZus{}potential}\PYG{p}{(}\PYG{n}{qq}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
がコメントアウトされていないかチェックする。

\sphinxAtStartPar
ポテンシャル磁場から少しずらしたい時は、 \sphinxcode{\sphinxupquote{mhd\_def.F90}} の中でRempel, 2012で定義されている \(\alpha\) が定義されている。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{potential\PYGZus{}alpha}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{2.5d0}
\end{sphinxVerbatim}

\sphinxAtStartPar
などとする。

\end{description}

\item {} \begin{description}
\sphinxlineitem{輻射輸送}
\sphinxAtStartPar
輻射輸送は複数本の光線を解くのが良い。
\sphinxcode{\sphinxupquote{rte\_def.F90}} を編集する。推奨される設定は

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kt}{logical}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{rte\PYGZus{}multiray\PYGZus{}flag}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{p}{.}\PYG{n}{true}\PYG{p}{.}
\PYG{k+kt}{logical}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{rte\PYGZus{}linear\PYGZus{}flag}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{p}{.}\PYG{n}{false}\PYG{p}{.}
\PYG{k+kt}{integer}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{mhd\PYGZus{}rte\PYGZus{}ratio}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}
\end{sphinxVerbatim}

\sphinxAtStartPar
とするのが良い。

\end{description}

\item {} \begin{description}
\sphinxlineitem{初期条件}
\sphinxAtStartPar
初期条件は、鉛直方向速度(vx)にランダムな微小速度を与えている。
黒点以外は磁場をゼロにしておく。
\sphinxcode{\sphinxupquote{model\_init.F90}} で

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{bx}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{0.d0}
\PYG{n}{by}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{0.d0}
\PYG{n}{bz}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{0.d0}
\end{sphinxVerbatim}

\sphinxAtStartPar
とすれば良い.

\sphinxAtStartPar
黒点設置のために \sphinxcode{\sphinxupquote{model\_sunspot.F90}} を編集。いくつかパラメタがあるが、変えたい時はプログラムのコメントを参照すること。 \sphinxcode{\sphinxupquote{io.F90}} を編集し、

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c}{!add something}
\PYG{n}{time00}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{0.d0}
\PYG{k}{if}\PYG{p}{(}\PYG{n}{ns}\PYG{+w}{ }\PYG{o}{==}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{+w}{ }\PYG{p}{.}\PYG{n+nb}{and}\PYG{p}{.}\PYG{+w}{ }\PYG{n}{nd}\PYG{+w}{ }\PYG{o}{==}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{+w}{ }\PYG{k}{then}
\PYG{k}{    }\PYG{k}{call }\PYG{n}{model\PYGZus{}sunspot}
\PYG{k}{endif}
\end{sphinxVerbatim}

\sphinxAtStartPar
とする。デフォルトでは、 \sphinxcode{\sphinxupquote{call model\_sunspot}} がコメントアウトされていることが多いと思われる。

\end{description}

\item {} \begin{description}
\sphinxlineitem{出力アウトプット}
\sphinxAtStartPar
ここは本当は完全に自由だが、データの出力の設定である。粒状斑の動きを詳しく見ようと思ったら30秒ほどの時間ケーデンスで出力するのが良い。
\sphinxcode{\sphinxupquote{main.F90}} を編集。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dtout}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{3}\PYG{l+m+mf}{0.d0}
\PYG{n}{ifac}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{1.d0}
\end{sphinxVerbatim}

\end{description}

\item {} \begin{description}
\sphinxlineitem{その他注意事項}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{model\_def.F90}} で \sphinxcode{\sphinxupquote{remap\_calc.F90}} で出力するスライスの位置を決定している。

\sphinxAtStartPar
と領域の真ん中を出力することにしているが、状況によって違う場所が出力されている場合がある。もし変なことが起こったらここをチェックしてみると良い。

\end{description}

\end{itemize}


\subsection{全対流層計算}
\label{\detokenize{typical_case:id9}}
\begin{sphinxadmonition}{note}{\label{\detokenize{typical_case:id10}}課題:}
\sphinxAtStartPar
全対流層計算の設定例
\end{sphinxadmonition}


\subsection{深い部分のみの計算}
\label{\detokenize{typical_case:id11}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Makefileのオプション
\begin{quote}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+nf}{PPC}\PYG{o}{:}\PYG{+w}{ }= \PYGZhy{}\PYG{n}{Ddeep} \PYG{c}{\PYGZsh{} 深い層のみ}
\PYG{n+nf}{PPC}\PYG{o}{:}\PYG{+w}{ }= \PYGZhy{}\PYG{n}{Done\PYGZus{}ray} \PYG{c}{\PYGZsh{} ここでは輻射輸送は解かないがone\PYGZus{}rayとしておくことでメモリ節約}
\PYG{n+nf}{PPC}\PYG{o}{:}\PYG{+w}{ }= \PYGZhy{}\PYG{n}{Dremap\PYGZus{}}2\PYG{n}{d\PYGZus{}assign} \PYG{c}{\PYGZsh{} remapで2次元的に出力する}
\PYG{n+nf}{PPC}\PYG{o}{:}\PYG{+w}{ }= \PYGZhy{}\PYG{n}{Dsoundwave\PYGZus{}suppress} \PYG{c}{\PYGZsh{} 音波が暴走するのを抑える}
\end{sphinxVerbatim}
\end{quote}

\item {} 
\sphinxAtStartPar
計算領域・解像度
\begin{quote}

\sphinxAtStartPar
水平方向には太陽半径程度、鉛直方向には \(0.71R_\odot\) から \(0.96R_\odot\) 程度までがおすすめ。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kt}{integer}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{private}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{nx0}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{64}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{ny0}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{64}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{nz0}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{64}
\PYG{k+kt}{integer}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ix0}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{jx0}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{+w}{ }\PYG{n}{kx0}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{2}

\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}

\PYG{c+cp}{\PYGZsh{}ifdef deep}
\PYG{+w}{    }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{xmax}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{0.96d0}\PYG{o}{*}\PYG{n}{rstar}
\PYG{+w}{    }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{xmin}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{0.71d0}\PYG{o}{*}\PYG{n}{rstar}
\PYG{c+cp}{\PYGZsh{}else}
\PYG{+w}{    }\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{ignore}\PYG{+w}{ }\PYG{n}{this}\PYG{p}{)}
\PYG{c+cp}{\PYGZsh{}endif}

\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}

\PYG{c+cp}{\PYGZsh{}ifdef deep}
\PYG{+w}{    }\PYG{c}{! for deep CZ calculation}
\PYG{+w}{    }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ymin}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{0.d0}
\PYG{+w}{    }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ymax}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{rstar}
\PYG{+w}{    }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{zmin}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{0.d0}
\PYG{+w}{    }\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{zmax}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{rstar}
\PYG{c+cp}{\PYGZsh{}else}
\PYG{+w}{    }\PYG{c}{! for surface calculation}
\PYG{+w}{    }\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{ignore}\PYG{+w}{ }\PYG{n}{this}\PYG{p}{)}
\PYG{c+cp}{\PYGZsh{}endif}
\end{sphinxVerbatim}
\end{quote}

\item {} 
\sphinxAtStartPar
音速抑制法

\item {} \begin{description}
\sphinxlineitem{音速抑制法}
\sphinxAtStartPar
対流層の深い部分のみを計算する場合は、音速と熱対流の比が大体同程度となるように設定する。
\sphinxcode{\sphinxupquote{src/all/background\_init.F90}} で設定しているがやや複雑なことをしているので、このままにしておくと良いであろう。

\end{description}

\item {} 
\sphinxAtStartPar
境界条件
\begin{quote}

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{scr/all/bc\_all.F90}} を見ると良い

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+cp}{\PYGZsh{}ifdef spherical}
\PYG{+w}{  }\PYG{p}{.}\PYG{p}{.}\PYG{p}{.}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{ignore}\PYG{+w}{ }\PYG{n}{this}\PYG{p}{)}
\PYG{c+cp}{\PYGZsh{}else}
\PYG{+w}{  }\PYG{k}{call }\PYG{n}{bcx\PYGZus{}deep}\PYG{p}{(}\PYG{n}{qq}\PYG{p}{)}
\PYG{c+cp}{\PYGZsh{}endif}
\end{sphinxVerbatim}
\end{quote}

\end{itemize}

\sphinxAtStartPar
となっていればオーケー
\begin{itemize}
\item {} \begin{description}
\sphinxlineitem{輻射輸送}
\sphinxAtStartPar
対流層の深い部分では、輻射輸送を解く必要はない。

\end{description}

\item {} 
\sphinxAtStartPar
初期条件
初期条件では、鉛直方向速度(vx)にランダムな微小速度を与えている。磁場を入れたい場合は、適当な値を \sphinxcode{\sphinxupquote{model\_init.F90}} で設定すれば良い。

\end{itemize}


\section{球座標(Yin\sphinxhyphen{}Yang格子含む)}
\label{\detokenize{typical_case:yin-yang}}

\subsection{Yin\sphinxhyphen{}Yangで深いところのみの計算}
\label{\detokenize{typical_case:id12}}\begin{itemize}
\item {} 
\sphinxAtStartPar
Makefileのオプション
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{PPC:= \$(PPC) \sphinxhyphen{}Ddeep}}

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{PPC:= \$(PPC) \sphinxhyphen{}Done\_ray}}

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{PPC:= \$(PPC) \sphinxhyphen{}Ddeep}}

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{PPC:= \$(PPC) \sphinxhyphen{}Dspherical}}

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{PPC:= \$(PPC) \sphinxhyphen{}DYinYang}}

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{PPC:= \$(PPC) \sphinxhyphen{}DnoFFTW}}

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{PPC:= \$(PPC) \sphinxhyphen{}Dremap\_2d\_assign}}

\end{itemize}

\item {} \begin{description}
\sphinxlineitem{格子点数}\begin{itemize}
\item {} 
\sphinxAtStartPar
Yin\sphinxhyphen{}Yang gridを使うために \sphinxcode{\sphinxupquote{ny0*jx0*3=nz0*kx0}} となるようにする

\end{itemize}

\end{description}

\end{itemize}


\section{2次元計算}
\label{\detokenize{typical_case:id13}}

\subsection{磁束管浮上}
\label{\detokenize{typical_case:id14}}
\sphinxAtStartPar
最終更新日：2024年04月05日

\sphinxstepscope


\chapter{方程式}
\label{\detokenize{equation:id1}}\label{\detokenize{equation::doc}}
\sphinxAtStartPar
R2D2で解く方程式は以下である。現状では、デカルト座標 \((x,y,z)\)  と球座標 \((r,\theta,\phi)\) を提供している。球座標を使う場合は、Yin\sphinxhyphen{}Yang格子を用いることもできる。数値計算コードの中では、\(x\) を重力方向(鉛直方向、動径方向)に取っているが、論文を書く際は各自適切に判断されたい。


\section{磁気流体力学}
\label{\detokenize{equation:id2}}
\sphinxAtStartPar
R2D2で解いている磁気流体力学の方程式は以下である。
\begin{equation*}
\begin{split}\frac{\partial \rho_1}{\partial t} &= - \frac{1}{\xi^2}\nabla\cdot
\left(\rho \boldsymbol{v}\right) \\
\frac{\partial}{\partial t}\left(\rho \boldsymbol{v}\right) &=
-\nabla\cdot\left(\rho\boldsymbol{vv}\right)
- \nabla p_1 - \rho_1 g\boldsymbol{e}_x
+\frac{1}{4\pi}\left(\nabla\times\boldsymbol{B}\right)
\times\boldsymbol{B} \\
\frac{\partial \boldsymbol{B}}{\partial t} &=
\nabla\times\left(\boldsymbol{v\times B}\right)
\\
\rho T \frac{\partial s_1}{\partial t} &= -\rho T
\left(\boldsymbol{v}\cdot\nabla\right) s + Q_\mathrm{rad} \\
p_1 &= p_1(\rho_1,s_1,x)\end{split}
\end{equation*}
\sphinxAtStartPar
ここで \(\rho\) は密度、\(\boldsymbol{v}\) は流体速度、\(\boldsymbol{B}\) は磁場、 \(s\) はエントロピー、\(p\) は圧力、 \(T\) は温度、 \(g\) は重力加速度、 \(Q_\mathrm{rad}\) は輻射による加熱率である。

\sphinxAtStartPar
R2D2では熱力学量を以下のように時間的に一定で \(x\) 方向の依存性のみを持つ0次の量とそこから擾乱の1次の量に分けている。
\begin{equation*}
\begin{split}\rho &= \rho_0 + \rho_1 \\
p &= p_0 + p_1 \\
s &= s_0 + s_1 \\
T &= T_0 + T_1 \\\end{split}
\end{equation*}
\sphinxAtStartPar
太陽内部では、\(\rho_1 \ll \rho_0\) などが成り立っているが、太陽表面では熱対流による擾乱と背景場は同程度となるので、R2D2の中では \(\rho_1 \ll \rho_0\) などは仮定しない。0次の量はModel Sを参考にして計算をしている。\sphinxhref{https://ui.adsabs.harvard.edu/abs/2020MNRAS.494.2523H/abstract}{Hotta \& Iijima2020} や \sphinxhref{https://ui.adsabs.harvard.edu/abs/2022ApJ...933..199H/abstract}{Hotta, Kusano and Shimada, 2022} を参照されたい。


\section{輻射輸送}
\label{\detokenize{equation:id3}}
\begin{sphinxadmonition}{note}{\label{\detokenize{equation:id4}}課題:}
\sphinxAtStartPar
輻射輸送の方程式
\end{sphinxadmonition}

\sphinxAtStartPar
最終更新日：2024年04月05日

\sphinxstepscope


\chapter{コード}
\label{\detokenize{code:id1}}\label{\detokenize{code::doc}}

\section{コーディングルール}
\label{\detokenize{code:id2}}
\begin{sphinxadmonition}{note}{\label{\detokenize{code:id3}}課題:}
\sphinxAtStartPar
コーディングルール
\end{sphinxadmonition}


\section{コード構造}
\label{\detokenize{code:id4}}
\begin{sphinxadmonition}{note}{\label{\detokenize{code:id5}}課題:}
\sphinxAtStartPar
コード構造
\end{sphinxadmonition}

\sphinxAtStartPar
最終更新日：2024年04月05日

\sphinxstepscope


\chapter{数値スキーム}
\label{\detokenize{scheme:id1}}\label{\detokenize{scheme::doc}}

\section{MHDスキーム}
\label{\detokenize{scheme:mhd}}

\subsection{空間微分}
\label{\detokenize{scheme:id2}}
\sphinxAtStartPar
R2D2では、4次の中央差分を用いている。格子間隔が一様な場合には中央差分では微分は
\begin{equation*}
\begin{split}\left(\frac{\partial q}{\partial x}\right)_i =\frac{-q_{i+2}+8q_{i+1}-8q_{i-1}+q_{i-2}}{12\Delta x_i}\end{split}
\end{equation*}
\sphinxAtStartPar
となる。R2D2では、非一様な格子間隔にも対応しており、


\subsection{時間積分}
\label{\detokenize{scheme:id3}}
\sphinxAtStartPar
R2D2では、

\begin{sphinxadmonition}{note}{\label{\detokenize{scheme:id4}}課題:}
\sphinxAtStartPar
数値スキーム(時間積分)
\end{sphinxadmonition}


\subsection{輻射輸送}
\label{\detokenize{scheme:id5}}
\begin{sphinxadmonition}{note}{\label{\detokenize{scheme:id6}}課題:}
\sphinxAtStartPar
数値スキーム(輻射輸送)
\end{sphinxadmonition}

\sphinxAtStartPar
最終更新日：2024年04月05日

\sphinxstepscope


\chapter{パラメータ}
\label{\detokenize{parameter:id1}}\label{\detokenize{parameter::doc}}
\begin{sphinxadmonition}{note}{\label{\detokenize{parameter:id2}}課題:}
\sphinxAtStartPar
パラメータ。どのグローバル変数がどのモジュールで定義されているかを整理する。
\end{sphinxadmonition}

\sphinxAtStartPar
最終更新日：2024年04月05日

\sphinxstepscope


\chapter{座標生成}
\label{\detokenize{geometry:id1}}\label{\detokenize{geometry::doc}}
\sphinxAtStartPar
R2D2では中央差分法を用いているが、そのほとんどは数値フラックスを用いて書き直すことでき、提供される \sphinxcode{\sphinxupquote{x}} , \sphinxcode{\sphinxupquote{y}}　, \sphinxcode{\sphinxupquote{z}} などは \sphinxstylestrong{セル中心} で定義される。よって計算領域内の最初のグリッドは、計算境界から半グリッド進んだところにある。

\sphinxAtStartPar
また、R2D2では一様グリッドと非一様グリッドどちらでも計算できるようにしている。


\section{一様グリッド}
\label{\detokenize{geometry:id2}}
\sphinxAtStartPar
一様グリッドを用いるときは
\begin{itemize}
\item {} 
\sphinxAtStartPar
格子間隔を計算する

\end{itemize}
\begin{equation*}
\begin{split}\Delta x = \frac{x_\mathrm{max} - x_\mathrm{min}}{N_x}\end{split}
\end{equation*}
\sphinxAtStartPar
ここで、コードでは、配列の要素数には \sphinxcode{\sphinxupquote{margin}} も含むので
\(N_x\) を計算するには \sphinxcode{\sphinxupquote{margin}} の部分を引く必要があることに注意。
\begin{itemize}
\item {} 
\sphinxAtStartPar
\(x_1\) を設定。\sphinxcode{\sphinxupquote{margin}} の分も考慮して計算する。

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{do loop}} で順次足していく

\end{itemize}

\sphinxAtStartPar
コードは以下のようになる

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{dx\PYGZus{}unif}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{p}{(}\PYG{n}{xmax}\PYG{o}{\PYGZhy{}}\PYG{n}{xmin}\PYG{p}{)}\PYG{o}{/}\PYG{k+kt}{real}\PYG{p}{(}\PYG{n}{ix00}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{2}\PYG{o}{*}\PYG{n}{marginx}\PYG{p}{)}
\PYG{n}{x00}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{xmin}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{p}{(}\PYG{l+m+mf}{0.5d0}\PYG{o}{\PYGZhy{}}\PYG{n+nb}{dble}\PYG{p}{(}\PYG{n}{marginx}\PYG{p}{)}\PYG{p}{)}\PYG{o}{*}\PYG{n}{dx\PYGZus{}unif}
\PYG{k}{if}\PYG{p}{(}\PYG{n}{xdcheck}\PYG{+w}{ }\PYG{o}{==}\PYG{+w}{ }\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{+w}{ }\PYG{k}{then}
\PYG{k}{    }\PYG{k}{do }\PYG{n}{i}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{1}\PYG{o}{+}\PYG{n}{i1}\PYG{p}{,}\PYG{n}{ix00}
\PYG{+w}{        }\PYG{n}{x00}\PYG{p}{(}\PYG{n}{i}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{x00}\PYG{p}{(}\PYG{n}{i}\PYG{o}{\PYGZhy{}}\PYG{n}{i1}\PYG{p}{)}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{n}{dx\PYGZus{}unif}
\PYG{+w}{    }\PYG{k}{enddo}
\PYG{k}{endif}
\end{sphinxVerbatim}


\section{非一様グリッド}
\label{\detokenize{geometry:id3}}
\sphinxAtStartPar
非一様グリッドを用いるときは、太陽光球付近は、輻射輸送のために一様なグリッド、ある程度の深さから格子間隔が線形に増加する非一様グリッドを使うことにしている。光球近くは、光球をちゃんと解像するために一様グリッド、光球からある程度進むと、非一様グリッドを採用することにしている。
実際の構造は以下のようになっている。非一様グリッド領域の両端２つのグリッド間隔は一様グリッドをとるようにしている。

\sphinxAtStartPar
fortranのコードの中では
\begin{itemize}
\item {} 
\sphinxAtStartPar
\(\Delta x_0\) \(\rightarrow\) \sphinxcode{\sphinxupquote{dx00}} : 一様グリッドでの格子点間隔

\item {} 
\sphinxAtStartPar
\(i_\mathrm{x\left(uni\right)}\) \(\rightarrow\) \sphinxcode{\sphinxupquote{ix\_ununi}}: 一様グリッドの格子点数

\item {} 
\sphinxAtStartPar
\(x_\mathrm{ran}\) \(\rightarrow\) \sphinxcode{\sphinxupquote{xrange}}: 領域サイズ

\item {} 
\sphinxAtStartPar
\(x_\mathrm{ran0}\) \(\rightarrow\) \sphinxcode{\sphinxupquote{xrange0}}: 一様グリッドの領域サイズ

\item {} 
\sphinxAtStartPar
\(x_\mathrm{ran1}\) \(\rightarrow\) \sphinxcode{\sphinxupquote{xrange1}}: 非一様グリッドの領域サイズ

\item {} 
\sphinxAtStartPar
\(n_x\) \(\rightarrow\) \sphinxcode{\sphinxupquote{nxx}} : 非一様グリッドの格子点数

\end{itemize}

\noindent\sphinxincludegraphics[width=700\sphinxpxdimen]{{ununiform_grid}.png}

\sphinxAtStartPar
一様グリッドでのグリッド間隔は \(\Delta x_0\) として、非一様グリッドでは \(\delta x\) ずつグリッド間隔が大きくなっていくとする。
\begin{equation*}
\begin{split}x_\mathrm{tran}&={\color{red} \frac{1}{2} \Delta x_0} + {\color{blue} \Delta x_0} + \Delta x_0
+ \left(\Delta x_0 + \delta x\right)
+ \left(\Delta x_0 + 2\delta x\right) + [...] \\
&+ \left[\Delta x_0 + \left(n_x - 4\right)\delta x\right]
+ {\color{blue}\left[\Delta x_0 + \left(n_x - 4\right)\delta x\right]}
+ {\color{red}\frac{1}{2}\left[\Delta x_0 + \left(n_x - 4\right)\delta x\right]} \\
&= {\color{red} \Delta x_0 + \frac{1}{2}\left(n_x-4\right)\delta x}
+{\color{blue} 2\Delta x_0 + \left(n_x - 4\right)\delta x}
+ \sum_{n=0}^{n_x - 4}\left(\Delta x_0 + n\delta x\right) \\
&= 3\Delta x_0 + \frac{3\left(n_x-4\right)\delta x}{2}
+ \frac{\left[2\Delta x_0 + \left(n_x-4\right)\delta x\right]\left(n_x - 3\right)}{2} \\
&= n_x \Delta x_0 + \frac{1}{2} n_x\left(n_x - 4\right)\delta x\end{split}
\end{equation*}
\sphinxAtStartPar
この関係式より、グリッド間隔の増分 \(\delta x\) を以下のように求めることができる。
\begin{equation*}
\begin{split}\delta x = \frac{2\left(x_\mathrm{tran} - n_x\Delta x_0\right)}{\left(n_x - 4\right)n_x}\end{split}
\end{equation*}
\sphinxAtStartPar
最終更新日：2024年04月05日

\sphinxstepscope


\chapter{境界条件}
\label{\detokenize{boundary:id1}}\label{\detokenize{boundary::doc}}
\sphinxAtStartPar
論文を書くときは
\begin{itemize}
\item {} 
\sphinxAtStartPar
\(x\) , \(y\) : 水平方向

\item {} 
\sphinxAtStartPar
\(z\) : 鉛直方向

\end{itemize}

\sphinxAtStartPar
となっているが、R2D2のコード内では
\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{x}}: 鉛直方向

\item {} 
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{y}}, \sphinxcode{\sphinxupquote{z}}: 水平方向

\end{itemize}

\sphinxAtStartPar
となっている。この取扱説明書では、コードに合わせた表記を用いる。

\sphinxAtStartPar
また、対称・反対称とは以下のような状況を表す。

\noindent\sphinxincludegraphics[width=450\sphinxpxdimen]{{bc_sym}.png}


\section{上部境界}
\label{\detokenize{boundary:id2}}

\subsection{ポテンシャル磁場}
\label{\detokenize{boundary:id3}}
\sphinxAtStartPar
磁場があるときは、上部ではポテンシャル磁場境界条件を使う。


\section{下部境界}
\label{\detokenize{boundary:id4}}
\sphinxAtStartPar
開く時
どの質量フラックスも対称にする。 計算領域内での質量を一定に保つために、水平に平均した密度
\(\langle \rho_1\rangle\) は反対称。 そこからのずれ
\(\rho_1 - \langle \rho_1 \rangle\) は対称な境界条件をとる。

\sphinxAtStartPar
一方、エントロピー \(s_1\) は上昇流で反対称、下降流で反対称な境界条件をとる。
この心は、開く境界条件を取るときは計算をしている領域の結果は信用するが、外から入ってくる物理量は、
計算領域に寄らないというものである。 下降流は現在計算している領域内部での情報を持って計算領域の外に出ていくので、
対称な境界条件を用いる。一方、上昇流は、計算している領域の外からの情報を持って計算領域に入ってくるので、
反対称な境界条件を用いて擾乱をゼロにする。これは元々のModel Sでの量を上昇流のエントロピーに用いるということである。

\sphinxAtStartPar
最終更新日：2024年04月05日

\sphinxstepscope


\chapter{人工粘性}
\label{\detokenize{artdif:id1}}\label{\detokenize{artdif::doc}}
\begin{sphinxadmonition}{note}{\label{\detokenize{artdif:id2}}課題:}
\sphinxAtStartPar
人工粘性
\end{sphinxadmonition}

\sphinxAtStartPar
最終更新日：2024年04月05日

\sphinxstepscope


\chapter{出力と読込}
\label{\detokenize{io:id1}}\label{\detokenize{io::doc}}

\section{出力}
\label{\detokenize{io:id2}}

\subsection{Fortranコード}
\label{\detokenize{io:fortran}}

\subsubsection{Sliceデータ}
\label{\detokenize{io:slice}}
\sphinxAtStartPar
R2D2では、スライスデータも高いケーデンスで出力できるようになっている。多くのデータを出力するのには効率の悪い方法になっているので、3\sphinxhyphen{}4枚のスライスを出力するのに留めておくことが推奨される。 \sphinxcode{\sphinxupquote{slice\_def.F90}} 内でどの部分のスライスを出力するかを定義している。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kt}{integer}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{nx\PYGZus{}slice}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{3}\PYG{+w}{ }\PYG{c}{! number of slice in x direction}
\PYG{k+kt}{integer}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{ny\PYGZus{}slice}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{2}\PYG{+w}{ }\PYG{c}{! number of slice in y direction}
\PYG{k+kt}{integer}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{parameter}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{nz\PYGZus{}slice}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mi}{2}\PYG{+w}{ }\PYG{c}{! number of slice in z direction}
\end{sphinxVerbatim}

\sphinxAtStartPar
この部分で、それぞれの方向に何枚のスライスを出力するかを定義。例えば \sphinxcode{\sphinxupquote{nx\_slice}} はスライスするy\sphinxhyphen{}z平面の数となる。実際にどの部分を出力するかは続く部分で指定している。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{dimension}\PYG{p}{(}\PYG{n}{nx\PYGZus{}slice}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{save}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{x\PYGZus{}slice}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{p}{(}\PYG{o}{/}\PYG{n}{xmin}\PYG{p}{,}\PYG{n}{rsun}\PYG{p}{,}\PYG{n}{xmax}\PYG{o}{/}\PYG{p}{)}
\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{dimension}\PYG{p}{(}\PYG{n}{ny\PYGZus{}slice}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{save}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{y\PYGZus{}slice}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{p}{(}\PYG{o}{/}\PYG{n}{ymin}\PYG{p}{,}\PYG{l+m+mf}{0.5d0}\PYG{o}{*}\PYG{p}{(}\PYG{n}{ymin}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{n}{ymax}\PYG{p}{)}\PYG{o}{/}\PYG{p}{)}
\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{p}{(}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{dimension}\PYG{p}{(}\PYG{n}{nz\PYGZus{}slice}\PYG{p}{)}\PYG{p}{,}\PYG{+w}{ }\PYG{k}{save}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{z\PYGZus{}slice}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{p}{(}\PYG{o}{/}\PYG{n}{zmin}\PYG{p}{,}\PYG{l+m+mf}{0.5d0}\PYG{o}{*}\PYG{p}{(}\PYG{n}{zmin}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{n}{zmax}\PYG{p}{)}\PYG{o}{/}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{nx\_slice}} で定義した数と合うように個数を指定しなければならない。


\section{読込}
\label{\detokenize{io:id3}}
\sphinxAtStartPar
読み込みについては、PythonコードとIDLコードを用意しているが、開発の頻度が高いPythonコードの利用を推奨している。


\subsection{Pythonコード}
\label{\detokenize{io:module-R2D2}}\label{\detokenize{io:python}}\index{module@\spxentry{module}!R2D2@\spxentry{R2D2}}\index{R2D2@\spxentry{R2D2}!module@\spxentry{module}}
\sphinxAtStartPar
PythonでR2D2で定義された関数を使うには

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{R2D2}
\end{sphinxVerbatim}

\sphinxAtStartPar
として、モジュールを読み込む。R2D2には {\hyperref[\detokenize{io:R2D2.R2D2_data}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{R2D2\_data}}}}} クラスが定義してあり、これをオブジェクト指向的に用いてデータを取り扱う。

\sphinxAtStartPar
以下にそれぞれの関数を示すが、docstringは記入してあるので

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{help}\PYG{p}{(}\PYG{n}{R2D2}\PYG{p}{)}
\PYG{n}{help}\PYG{p}{(}\PYG{n}{R2D2}\PYG{o}{.}\PYG{n}{R2D2\PYGZus{}data}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
などとすると実行環境で、モジュール全体や各関数の簡単な説明を見ることができる。


\subsubsection{クラス}
\label{\detokenize{io:id4}}\index{R2D2\_data (R2D2 のクラス)@\spxentry{R2D2\_data}\spxextra{R2D2 のクラス}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxbfcode{\sphinxupquote{class\DUrole{w}{ }}}\sphinxcode{\sphinxupquote{R2D2.}}\sphinxbfcode{\sphinxupquote{R2D2\_data}}}{\sphinxparam{\DUrole{n}{datadir}}}{}
\pysigstopsignatures
\end{fulllineitems}


\sphinxAtStartPar
データの読み込みには \sphinxcode{\sphinxupquote{R2D2}} モジュールの中で定義されている \sphinxcode{\sphinxupquote{R2D2\_data}} クラスを使う必要がある。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{R2D2}
\PYG{n}{datadir} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../run/d002/data}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{d} \PYG{o}{=} \PYG{n}{R2D2}\PYG{o}{.}\PYG{n}{R2D2\PYGZus{}data}\PYG{p}{(}\PYG{n}{datadir}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
などとしてインスタンスを生成する。


\subsubsection{Attribute}
\label{\detokenize{io:attribute}}\index{p (R2D2.R2D2\_data の属性)@\spxentry{p}\spxextra{R2D2.R2D2\_data の属性}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data.p}}
\pysigstartsignatures
\pysigline{\sphinxcode{\sphinxupquote{R2D2\_data.}}\sphinxbfcode{\sphinxupquote{p}}}
\pysigstopsignatures
\sphinxAtStartPar
基本的なパラメタ。格子点数 \sphinxcode{\sphinxupquote{ix}} や領域サイズ \sphinxcode{\sphinxupquote{xmax}} など。
インスタンス生成時に同時に読み込まれる。

\end{fulllineitems}

\index{t (R2D2.R2D2\_data の属性)@\spxentry{t}\spxextra{R2D2.R2D2\_data の属性}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data.t}}
\pysigstartsignatures
\pysigline{\sphinxcode{\sphinxupquote{R2D2\_data.}}\sphinxbfcode{\sphinxupquote{t}}}
\pysigstopsignatures
\sphinxAtStartPar
時間を格納するデータ。　{\hyperref[\detokenize{io:R2D2.R2D2_data.read_time}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{R2D2\_data.read\_time()}}}}} では戻り値として同じ値を返すために \sphinxcode{\sphinxupquote{R2D2\_Data.t}} はあまり使われない。

\end{fulllineitems}

\index{qs (R2D2.R2D2\_data の属性)@\spxentry{qs}\spxextra{R2D2.R2D2\_data の属性}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data.qs}}
\pysigstartsignatures
\pysigline{\sphinxcode{\sphinxupquote{R2D2\_data.}}\sphinxbfcode{\sphinxupquote{qs}}}
\pysigstopsignatures
\sphinxAtStartPar
ある高さの2次元のndarrayが含まれる辞書型。 {\hyperref[\detokenize{io:R2D2.R2D2_data.read_qq_select}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{R2D2\_data.read\_qq\_select()}}}}} で読み込んだ結果。

\end{fulllineitems}

\index{qq (R2D2.R2D2\_data の属性)@\spxentry{qq}\spxextra{R2D2.R2D2\_data の属性}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data.qq}}
\pysigstartsignatures
\pysigline{\sphinxcode{\sphinxupquote{R2D2\_data.}}\sphinxbfcode{\sphinxupquote{qq}}}
\pysigstopsignatures
\sphinxAtStartPar
3次元のnumpy array。計算領域全体のデータ。{\hyperref[\detokenize{io:R2D2.R2D2_data.read_qq}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{R2D2\_data.read\_qq()}}}}} で読み込んだ結果。

\end{fulllineitems}

\index{qt (R2D2.R2D2\_data の属性)@\spxentry{qt}\spxextra{R2D2.R2D2\_data の属性}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data.qt}}
\pysigstartsignatures
\pysigline{\sphinxcode{\sphinxupquote{R2D2\_data.}}\sphinxbfcode{\sphinxupquote{qt}}}
\pysigstopsignatures
\sphinxAtStartPar
2次元のnumpy array。ある光学的厚さの面でのデータ。現在は光学的厚さ1, 0.1, 0.01でのデータを出力している。 {\hyperref[\detokenize{io:R2D2.R2D2_data.read_qq_tau}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{R2D2\_data.read\_qq\_tau()}}}}} で読み込んだ結果。

\end{fulllineitems}

\index{vc (R2D2.R2D2\_data の属性)@\spxentry{vc}\spxextra{R2D2.R2D2\_data の属性}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data.vc}}
\pysigstartsignatures
\pysigline{\sphinxcode{\sphinxupquote{R2D2\_data.}}\sphinxbfcode{\sphinxupquote{vc}}}
\pysigstopsignatures
\sphinxAtStartPar
Fortranの計算の中で解析した結果。 {\hyperref[\detokenize{io:R2D2.R2D2_data.read_vc}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{R2D2\_data.read\_vc()}}}}} で読み込んだ結果。

\end{fulllineitems}

\index{qc (R2D2.R2D2\_data の属性)@\spxentry{qc}\spxextra{R2D2.R2D2\_data の属性}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data.qc}}
\pysigstartsignatures
\pysigline{\sphinxcode{\sphinxupquote{R2D2\_data.}}\sphinxbfcode{\sphinxupquote{qc}}}
\pysigstopsignatures
\sphinxAtStartPar
3次元のnumpy array。計算領域全体のデータ。Fortranの計算でチェックポイントのために出力しているデータを読み込む。主に解像度をあげたいときのために使う {\hyperref[\detokenize{io:R2D2.R2D2_data.read_qq_check}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{R2D2\_data.read\_qq\_check()}}}}} で読み込んだ結果。

\end{fulllineitems}

\index{ql (R2D2.R2D2\_data の属性)@\spxentry{ql}\spxextra{R2D2.R2D2\_data の属性}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data.ql}}
\pysigstartsignatures
\pysigline{\sphinxcode{\sphinxupquote{R2D2\_data.}}\sphinxbfcode{\sphinxupquote{ql}}}
\pysigstopsignatures
\sphinxAtStartPar
2次元のnumpy array。Fortranで定義したスライスデータ {\hyperref[\detokenize{io:R2D2.R2D2_data.read_qq_slice}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{R2D2\_data.read\_qq\_slice()}}}}} で読み込んだ結果。
実際にどの位置のスライスを読み込んでいるかは \sphinxcode{\sphinxupquote{R2D2.p{[}\textquotesingle{}x\_slice\textquotesingle{}{]}}}, \sphinxcode{\sphinxupquote{R2D2.p{[}\textquotesingle{}y\_slice\textquotesingle{}{]}}}, \sphinxcode{\sphinxupquote{R2D2.p{[}\textquotesingle{}z\_slice\textquotesingle{}{]}}} を参照すること。スライスの位置の配列が保存されている。

\end{fulllineitems}


\sphinxAtStartPar
{\hyperref[\detokenize{io:R2D2.R2D2_data.p}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{R2D2\_data.p}}}}} については、\sphinxcode{\sphinxupquote{init.py}} などで

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{R2D2}
\PYG{n}{d} \PYG{o}{=} \PYG{n}{R2D2}\PYG{o}{.}\PYG{n}{R2D2\PYGZus{}data}\PYG{p}{(}\PYG{n}{datadir}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{key} \PYG{o+ow}{in} \PYG{n}{R2D2}\PYG{o}{.}\PYG{n}{p}\PYG{p}{:}
    \PYG{n}{exec}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZpc{}s}\PYG{l+s+s1}{ = }\PYG{l+s+si}{\PYGZpc{}s}\PYG{l+s+si}{\PYGZpc{}s}\PYG{l+s+si}{\PYGZpc{}s}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{\PYGZpc{}} \PYG{p}{(}\PYG{n}{key}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{R2D2.p[}\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{key}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{]}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
などとしているために、辞書型の \sphinxcode{\sphinxupquote{key}} を名前にする変数に値が代入されている。例えば、 \sphinxcode{\sphinxupquote{R2D2\_data.p{[}\textquotesingle{}ix\textquotesingle{}{]}}} と \sphinxcode{\sphinxupquote{ix}} には同じ値が入っている。


\subsubsection{Method}
\label{\detokenize{io:method}}

\paragraph{データ読み込み}
\label{\detokenize{io:id5}}
\sphinxAtStartPar
メソッドで指定する \sphinxcode{\sphinxupquote{datadir}} はデータの場所を示す変数。R2D2の計算を実行すると \sphinxcode{\sphinxupquote{data}} ディレクトリが生成されて、その中にデータが保存される。この場所を指定すれば良い。
\index{\_\_init\_\_() (R2D2.R2D2\_data のメソッド)@\spxentry{\_\_init\_\_()}\spxextra{R2D2.R2D2\_data のメソッド}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data.__init__}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxcode{\sphinxupquote{R2D2\_data.}}\sphinxbfcode{\sphinxupquote{\_\_init\_\_}}}{\sphinxparam{\DUrole{n}{datadir}}}{}
\pysigstopsignatures
\sphinxAtStartPar
インスタンス生成時に実行されるメソッド。計算設定などのパラメタが読み込まれる。 {\hyperref[\detokenize{io:R2D2.R2D2_data.p}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{R2D2\_data.p}}}}} にデータが保存される。
\begin{quote}\begin{description}
\sphinxlineitem{パラメータ}
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{datadir}} (\sphinxstyleliteralemphasis{\sphinxupquote{str}}) \sphinxhyphen{}\sphinxhyphen{} データの場所

\end{description}\end{quote}

\end{fulllineitems}

\index{read\_qq\_select() (R2D2.R2D2\_data のメソッド)@\spxentry{read\_qq\_select()}\spxextra{R2D2.R2D2\_data のメソッド}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data.read_qq_select}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxcode{\sphinxupquote{R2D2\_data.}}\sphinxbfcode{\sphinxupquote{read\_qq\_select}}}{\sphinxparam{\DUrole{n}{xs}}\sphinxparamcomma \sphinxparam{\DUrole{n}{n}}\sphinxparamcomma \sphinxparam{\DUrole{n}{silent}\DUrole{o}{=}\DUrole{default_value}{False}}}{}
\pysigstopsignatures
\sphinxAtStartPar
ある高さのデータのスライスを読み込む。戻り値を返さない時も {\hyperref[\detokenize{io:R2D2.R2D2_data.qs}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{R2D2\_data.qs}}}}} にデータが保存される。
\begin{quote}\begin{description}
\sphinxlineitem{パラメータ}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{xs}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} 読み込みたいデータの高さ

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{n}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}) \sphinxhyphen{}\sphinxhyphen{} 読み込みたい時間ステップ

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{silent}} (\sphinxstyleliteralemphasis{\sphinxupquote{bool}}) \sphinxhyphen{}\sphinxhyphen{} 読み込み時にどの変数に格納されたかメッセージの表示を抑制するフラグ。デフォルトはFalseで、Trueだとメッセージは表示されない。

\end{itemize}

\end{description}\end{quote}

\end{fulllineitems}

\index{read\_qq() (R2D2.R2D2\_data のメソッド)@\spxentry{read\_qq()}\spxextra{R2D2.R2D2\_data のメソッド}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data.read_qq}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxcode{\sphinxupquote{R2D2\_data.}}\sphinxbfcode{\sphinxupquote{read\_qq}}}{\sphinxparam{\DUrole{n}{n}}\sphinxparamcomma \sphinxparam{\DUrole{n}{silent}\DUrole{o}{=}\DUrole{default_value}{False}}}{}
\pysigstopsignatures
\sphinxAtStartPar
3次元のデータを読み込む。戻り値を返さない時も {\hyperref[\detokenize{io:R2D2.R2D2_data.qq}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{R2D2\_data.qq}}}}} にデータが保存される。
\begin{quote}\begin{description}
\sphinxlineitem{パラメータ}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{n}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}) \sphinxhyphen{}\sphinxhyphen{} 読み込みたい時間ステップ

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{silent}} (\sphinxstyleliteralemphasis{\sphinxupquote{bool}}) \sphinxhyphen{}\sphinxhyphen{} 読み込み時にどの変数に格納されたかメッセージの表示を抑制するフラグ。デフォルトはFalseで、Trueだとメッセージは表示されない。

\end{itemize}

\end{description}\end{quote}

\end{fulllineitems}

\index{read\_qq\_tau() (R2D2.R2D2\_data のメソッド)@\spxentry{read\_qq\_tau()}\spxextra{R2D2.R2D2\_data のメソッド}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data.read_qq_tau}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxcode{\sphinxupquote{R2D2\_data.}}\sphinxbfcode{\sphinxupquote{read\_qq\_tau}}}{\sphinxparam{\DUrole{n}{n}}\sphinxparamcomma \sphinxparam{\DUrole{n}{silent}\DUrole{o}{=}\DUrole{default_value}{False}}}{}
\pysigstopsignatures
\sphinxAtStartPar
光学的厚さが一定の2次元のデータを読み込む。{\hyperref[\detokenize{io:R2D2.R2D2_data.qt}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{R2D2\_data.qt}}}}} にデータが保存される。
\begin{quote}\begin{description}
\sphinxlineitem{パラメータ}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{n}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}) \sphinxhyphen{}\sphinxhyphen{} 読み込みたい時間ステップ

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{silent}} (\sphinxstyleliteralemphasis{\sphinxupquote{bool}}) \sphinxhyphen{}\sphinxhyphen{} 読み込み時にどの変数に格納されたかメッセージの表示を抑制するフラグ。デフォルトはFalseで、Trueだとメッセージは表示されない。

\end{itemize}

\end{description}\end{quote}

\end{fulllineitems}

\index{read\_time() (R2D2.R2D2\_data のメソッド)@\spxentry{read\_time()}\spxextra{R2D2.R2D2\_data のメソッド}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data.read_time}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxcode{\sphinxupquote{R2D2\_data.}}\sphinxbfcode{\sphinxupquote{read\_time}}}{\sphinxparam{\DUrole{n}{n}}\sphinxparamcomma \sphinxparam{\DUrole{n}{tau}\DUrole{o}{=}\DUrole{default_value}{False}}\sphinxparamcomma \sphinxparam{\DUrole{n}{silent}\DUrole{o}{=}\DUrole{default_value}{False}}}{}
\pysigstopsignatures
\sphinxAtStartPar
時間を読み込む。 \sphinxcode{\sphinxupquote{R2D2.t}} にもデータは格納されるが戻り値としても使うことができる。
\begin{quote}\begin{description}
\sphinxlineitem{パラメータ}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{n}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}) \sphinxhyphen{}\sphinxhyphen{} 読み込みたい時間ステップ

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{tau}} (\sphinxstyleliteralemphasis{\sphinxupquote{bool}}) \sphinxhyphen{}\sphinxhyphen{} 光学的厚さ一定のデータ(高ケーデンス)に対する時間を読むかのフラグ。デフォルトはFalse。

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{silent}} (\sphinxstyleliteralemphasis{\sphinxupquote{bool}}) \sphinxhyphen{}\sphinxhyphen{} 読み込み時にどの変数に格納されたかメッセージの表示を抑制するフラグ。デフォルトはFalseで、Trueだとメッセージは表示されない。

\end{itemize}

\sphinxlineitem{戻り値}
\sphinxAtStartPar
時間ステップでの時間

\end{description}\end{quote}

\end{fulllineitems}

\index{read\_vc() (R2D2.R2D2\_data のメソッド)@\spxentry{read\_vc()}\spxextra{R2D2.R2D2\_data のメソッド}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data.read_vc}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxcode{\sphinxupquote{R2D2\_data.}}\sphinxbfcode{\sphinxupquote{read\_vc}}}{\sphinxparam{\DUrole{n}{n}}\sphinxparamcomma \sphinxparam{\DUrole{n}{silent}\DUrole{o}{=}\DUrole{default_value}{False}}}{}
\pysigstopsignatures
\sphinxAtStartPar
Fortranコードの中で解析した計算結果を読み込む。戻り値を返さない時も {\hyperref[\detokenize{io:R2D2.R2D2_data.vc}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{R2D2\_data.vc}}}}} にデータが保存される。
\begin{quote}\begin{description}
\sphinxlineitem{パラメータ}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{n}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}) \sphinxhyphen{}\sphinxhyphen{} 読み込みたい時間ステップ

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{silent}} (\sphinxstyleliteralemphasis{\sphinxupquote{bool}}) \sphinxhyphen{}\sphinxhyphen{} 読み込み時にどの変数に格納されたかメッセージの表示を抑制するフラグ。デフォルトはFalseで、Trueだとメッセージは表示されない。

\end{itemize}

\end{description}\end{quote}

\end{fulllineitems}

\index{read\_qq\_check() (R2D2.R2D2\_data のメソッド)@\spxentry{read\_qq\_check()}\spxextra{R2D2.R2D2\_data のメソッド}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data.read_qq_check}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxcode{\sphinxupquote{R2D2\_data.}}\sphinxbfcode{\sphinxupquote{read\_qq\_check}}}{\sphinxparam{\DUrole{n}{n}}\sphinxparamcomma \sphinxparam{\DUrole{n}{silent}\DUrole{o}{=}\DUrole{default_value}{False}}\sphinxparamcomma \sphinxparam{\DUrole{n}{end\_step}\DUrole{o}{=}\DUrole{default_value}{False}}}{}
\pysigstopsignatures
\sphinxAtStartPar
チェックポイントのための3次元データを読み込む。主に解像度をあげるときに使う。 {\hyperref[\detokenize{io:R2D2.R2D2_data.qc}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{R2D2\_data.qc}}}}} にデータが保存される。
\begin{quote}\begin{description}
\sphinxlineitem{パラメータ}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{n}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}) \sphinxhyphen{}\sphinxhyphen{} 読み込みたい時間ステップ

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{silent}} (\sphinxstyleliteralemphasis{\sphinxupquote{bool}}) \sphinxhyphen{}\sphinxhyphen{} 読み込み時にどの変数に格納されたかメッセージの表示を抑制するフラグ。デフォルトはFalseで、Trueだとメッセージは表示されない。

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{end\_step}} (\sphinxstyleliteralemphasis{\sphinxupquote{book}}) \sphinxhyphen{}\sphinxhyphen{} Falseの時は、 \sphinxcode{\sphinxupquote{n}} で指定された時間ステップのデータを読み込むが3次元データはそれほど高頻度ではな出力していない。Trueの時は、 \sphinxcode{\sphinxupquote{qq.dac.e}} もしくは　\sphinxcode{\sphinxupquote{qq.dac.o}} という最後の1ステップの出力データを読み込む。こちらは常に上書きされてしまっているが、毎ステップ必ず書き込むので最後のステップのデータを読み込みたい時はこちらをTrueにする。

\end{itemize}

\end{description}\end{quote}

\end{fulllineitems}

\index{read\_qq\_slice() (R2D2.R2D2\_data のメソッド)@\spxentry{read\_qq\_slice()}\spxextra{R2D2.R2D2\_data のメソッド}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data.read_qq_slice}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxcode{\sphinxupquote{R2D2\_data.}}\sphinxbfcode{\sphinxupquote{read\_qq\_slice}}}{\sphinxparam{\DUrole{n}{n}}\sphinxparamcomma \sphinxparam{\DUrole{n}{n\_slice}}\sphinxparamcomma \sphinxparam{\DUrole{n}{direc}}\sphinxparamcomma \sphinxparam{\DUrole{n}{silent}\DUrole{o}{=}\DUrole{default_value}{False}}}{}
\pysigstopsignatures
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{slice\_def.F90}} で指定したスライスデータを読み込む。{\hyperref[\detokenize{io:R2D2.R2D2_data.ql}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{R2D2\_data.ql}}}}} にデータが保存される。
\begin{quote}\begin{description}
\sphinxlineitem{パラメータ}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{n}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}) \sphinxhyphen{}\sphinxhyphen{} 読み込みたい時間ステップ

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{n\_slice}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}) \sphinxhyphen{}\sphinxhyphen{} 何枚目のスライスを読み込むか

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{direc}} (\sphinxstyleliteralemphasis{\sphinxupquote{str}}) \sphinxhyphen{}\sphinxhyphen{} スライスの方向 \textquotesingle{}x\textquotesingle{}, \textquotesingle{}y\textquotesingle{}, \textquotesingle{}z\textquotesingle{}のどれか

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{silent}} (\sphinxstyleliteralemphasis{\sphinxupquote{bool}}) \sphinxhyphen{}\sphinxhyphen{} 読み込み時にどの変数に格納されたかメッセージの表示を抑制するフラグ。デフォルトはFalseで、Trueだとメッセージは表示されない。

\end{itemize}

\end{description}\end{quote}

\end{fulllineitems}



\paragraph{データダウンロード}
\label{\detokenize{io:id6}}
\sphinxAtStartPar
スパコンなどで計算した後に、ローカルの環境にデータをダウンロードするメソッドも提供している。堀田と全く同じようにディレクトリ構造を作ってないといけないので注意。
\index{R2D2.sync.set() (R2D2 モジュール)@\spxentry{R2D2.sync.set()}\spxextra{R2D2 モジュール}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2.sync.set}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxcode{\sphinxupquote{R2D2.sync.}}\sphinxbfcode{\sphinxupquote{set}}}{\sphinxparam{\DUrole{n}{server}}\sphinxparamcomma \sphinxparam{\DUrole{n}{caseid}}\sphinxparamcomma \sphinxparam{\DUrole{n}{project}\DUrole{o}{=}\DUrole{default_value}{os.getcwd().split(\textquotesingle{}/\textquotesingle{}){[}\sphinxhyphen{}2{]}}}\sphinxparamcomma \sphinxparam{\DUrole{n}{dist}\DUrole{o}{=}\DUrole{default_value}{\textquotesingle{}../run/\textquotesingle{}}}}{}
\pysigstopsignatures
\sphinxAtStartPar
設定のみをダウンロードするメソッド。ひとまずGoogleスプレッドシートに書き込みたい時などに有用。
\begin{quote}\begin{description}
\sphinxlineitem{パラメータ}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{server}} (\sphinxstyleliteralemphasis{\sphinxupquote{char}}) \sphinxhyphen{}\sphinxhyphen{} ダウンロード先のサーバー名。sshで使うサーバー名を用いれば良い。

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{server}} \sphinxhyphen{}\sphinxhyphen{} ダウンロードしたいcaseid。\textquotesingle{}d001\textquotesingle{}などとする。

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{project}} (\sphinxstyleliteralemphasis{\sphinxupquote{char}}) \sphinxhyphen{}\sphinxhyphen{} プロジェクト名。\textquotesingle{}R2D2\textquotesingle{}など。何も入力しなければ一個上のディレクトリの名前をプロジェクト名と判断する。

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{dist}} (\sphinxstyleliteralemphasis{\sphinxupquote{char}}) \sphinxhyphen{}\sphinxhyphen{} データダウンロード先。特別な用途がなければデフォルトのままとする。

\end{itemize}

\end{description}\end{quote}

\end{fulllineitems}

\index{sync\_tau() (R2D2.R2D2\_data のメソッド)@\spxentry{sync\_tau()}\spxextra{R2D2.R2D2\_data のメソッド}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data.sync_tau}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxcode{\sphinxupquote{R2D2\_data.}}\sphinxbfcode{\sphinxupquote{sync\_tau}}}{\sphinxparam{\DUrole{n}{server}}\sphinxparamcomma \sphinxparam{\DUrole{n}{project}\DUrole{o}{=}\DUrole{default_value}{os.getcwd().split(\textquotesingle{}/\textquotesingle{}){[}\sphinxhyphen{}2{]}}}}{}
\pysigstopsignatures
\sphinxAtStartPar
光学的厚さ一定の面上でのデータをダウンロードするメソッド。
\begin{quote}\begin{description}
\sphinxlineitem{パラメータ}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{server}} (\sphinxstyleliteralemphasis{\sphinxupquote{char}}) \sphinxhyphen{}\sphinxhyphen{} ダウンロード先のサーバー名。sshで使うサーバー名を用いれば良い。

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{project}} (\sphinxstyleliteralemphasis{\sphinxupquote{char}}) \sphinxhyphen{}\sphinxhyphen{} プロジェクト名。\textquotesingle{}R2D2\textquotesingle{}など。何も入力しなければ一個上のディレクトリの名前をプロジェクト名と判断する。

\end{itemize}

\end{description}\end{quote}

\end{fulllineitems}

\index{sync\_select() (R2D2.R2D2\_data のメソッド)@\spxentry{sync\_select()}\spxextra{R2D2.R2D2\_data のメソッド}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data.sync_select}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxcode{\sphinxupquote{R2D2\_data.}}\sphinxbfcode{\sphinxupquote{sync\_select}}}{\sphinxparam{\DUrole{n}{xs}}\sphinxparamcomma \sphinxparam{\DUrole{n}{server}}\sphinxparamcomma \sphinxparam{\DUrole{n}{project}\DUrole{o}{=}\DUrole{default_value}{os.getcwd().split(\textquotesingle{}/\textquotesingle{}){[}\sphinxhyphen{}2{]}}}}{}
\pysigstopsignatures
\sphinxAtStartPar
２次元データをダウンロードするメソッド
\begin{quote}\begin{description}
\sphinxlineitem{パラメータ}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{xs}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} ダウンロードする高さ。

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{server}} (\sphinxstyleliteralemphasis{\sphinxupquote{char}}) \sphinxhyphen{}\sphinxhyphen{} ダウンロード先のサーバー名。sshで使うサーバー名を用いれば良い。

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{project}} (\sphinxstyleliteralemphasis{\sphinxupquote{char}}) \sphinxhyphen{}\sphinxhyphen{} プロジェクト名。\textquotesingle{}R2D2\textquotesingle{}など。何も入力しなければ一個上のディレクトリの名前をプロジェクト名と判断する。

\end{itemize}

\end{description}\end{quote}

\end{fulllineitems}

\index{sync\_vc() (R2D2.R2D2\_data のメソッド)@\spxentry{sync\_vc()}\spxextra{R2D2.R2D2\_data のメソッド}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data.sync_vc}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxcode{\sphinxupquote{R2D2\_data.}}\sphinxbfcode{\sphinxupquote{sync\_vc}}}{\sphinxparam{\DUrole{n}{server}}\sphinxparamcomma \sphinxparam{\DUrole{n}{project}\DUrole{o}{=}\DUrole{default_value}{os.getcwd().split(\textquotesingle{}/\textquotesingle{}){[}\sphinxhyphen{}2{]}}}}{}
\pysigstopsignatures
\sphinxAtStartPar
計算実行中に解析した物理量をダウンロードするメソッド
\begin{quote}\begin{description}
\sphinxlineitem{パラメータ}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{server}} (\sphinxstyleliteralemphasis{\sphinxupquote{char}}) \sphinxhyphen{}\sphinxhyphen{} ダウンロード先のサーバー名。sshで使うサーバー名を用いれば良い。

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{project}} (\sphinxstyleliteralemphasis{\sphinxupquote{char}}) \sphinxhyphen{}\sphinxhyphen{} プロジェクト名。\textquotesingle{}R2D2\textquotesingle{}など。何も入力しなければ一個上のディレクトリの名前をプロジェクト名と判断する。

\end{itemize}

\end{description}\end{quote}

\end{fulllineitems}

\index{sync\_check() (R2D2.R2D2\_data のメソッド)@\spxentry{sync\_check()}\spxextra{R2D2.R2D2\_data のメソッド}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data.sync_check}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxcode{\sphinxupquote{R2D2\_data.}}\sphinxbfcode{\sphinxupquote{sync\_check}}}{\sphinxparam{\DUrole{n}{n}}\sphinxparamcomma \sphinxparam{\DUrole{n}{server}}\sphinxparamcomma \sphinxparam{\DUrole{n}{project}\DUrole{o}{=}\DUrole{default_value}{os.getcwd().split(\textquotesingle{}/\textquotesingle{}){[}\sphinxhyphen{}2{]}}}\sphinxparamcomma \sphinxparam{\DUrole{n}{end\_step}\DUrole{o}{=}\DUrole{default_value}{False}}}{}
\pysigstopsignatures
\sphinxAtStartPar
チェックポイントデータをダウンロードするメソッド
\begin{quote}\begin{description}
\sphinxlineitem{パラメータ}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{n}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}) \sphinxhyphen{}\sphinxhyphen{} ダウンロードしたい時間ステップ。

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{server}} (\sphinxstyleliteralemphasis{\sphinxupquote{char}}) \sphinxhyphen{}\sphinxhyphen{} ダウンロード先のサーバー名。sshで使うサーバー名を用いれば良い。

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{project}} (\sphinxstyleliteralemphasis{\sphinxupquote{char}}) \sphinxhyphen{}\sphinxhyphen{} プロジェクト名。\textquotesingle{}R2D2\textquotesingle{}など。何も入力しなければ一個上のディレクトリの名前をプロジェクト名と判断する。

\end{itemize}

\end{description}\end{quote}

\end{fulllineitems}



\subsection{解像度・計算領域変更}
\label{\detokenize{io:id7}}
\sphinxAtStartPar
R2D2のPythonの機能を用いて, 解像度や計算領域を変更することができる.

\sphinxAtStartPar
以下の手順に従う
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
fortranコードで何らかの計算を実行

\item {} 
\sphinxAtStartPar
pythonで読み込み。解像度変換を実行

\item {} 
\sphinxAtStartPar
fortranで再度, 計算を実行

\end{enumerate}

\sphinxAtStartPar
pythonでの解像度変換には {\hyperref[\detokenize{io:R2D2.R2D2_data.upgrade_resolution}]{\sphinxcrossref{\sphinxcode{\sphinxupquote{R2D2\_data.upgrade\_resolution()}}}}} メソッドを用いる.
\index{upgrade\_resolution() (R2D2.R2D2\_data のメソッド)@\spxentry{upgrade\_resolution()}\spxextra{R2D2.R2D2\_data のメソッド}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{io:R2D2.R2D2_data.upgrade_resolution}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxcode{\sphinxupquote{R2D2\_data.}}\sphinxbfcode{\sphinxupquote{upgrade\_resolution}}}{\sphinxparam{\DUrole{n}{caseid}}\sphinxparamcomma \sphinxparam{\DUrole{n}{n}}\sphinxparamcomma \sphinxparam{\DUrole{n}{xmin}}\sphinxparamcomma \sphinxparam{\DUrole{n}{xmax}}\sphinxparamcomma \sphinxparam{\DUrole{n}{ymin}}\sphinxparamcomma \sphinxparam{\DUrole{n}{ymax}}\sphinxparamcomma \sphinxparam{\DUrole{n}{zmin}}\sphinxparamcomma \sphinxparam{\DUrole{n}{zmax}}\sphinxparamcomma \sphinxparam{\DUrole{n}{ix}}\sphinxparamcomma \sphinxparam{\DUrole{n}{jx}}\sphinxparamcomma \sphinxparam{\DUrole{n}{kx}}\sphinxparamcomma \sphinxparam{\DUrole{n}{ix\_ununi}\DUrole{o}{=}\DUrole{default_value}{32}}\sphinxparamcomma \sphinxparam{\DUrole{n}{dx00}\DUrole{o}{=}\DUrole{default_value}{48e5}}\sphinxparamcomma \sphinxparam{\DUrole{n}{x\_ununif}\DUrole{o}{=}\DUrole{default_value}{False}}\sphinxparamcomma \sphinxparam{\DUrole{n}{endian}\DUrole{o}{=}\DUrole{default_value}{\textquotesingle{}\textless{}\textquotesingle{}}}\sphinxparamcomma \sphinxparam{\DUrole{n}{end\_step}\DUrole{o}{=}\DUrole{default_value}{False}}\sphinxparamcomma \sphinxparam{\DUrole{n}{memory\_saving}\DUrole{o}{=}\DUrole{default_value}{False}}}{}
\pysigstopsignatures
\sphinxAtStartPar
データの解像度や計算領域を変更するためのメソッド
\begin{quote}\begin{description}
\sphinxlineitem{パラメータ}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{caseid}} (\sphinxstyleliteralemphasis{\sphinxupquote{char}}) \sphinxhyphen{}\sphinxhyphen{} 出力先のcaseid e.g. \textquotesingle{}d002\textquotesingle{}

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{n}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}) \sphinxhyphen{}\sphinxhyphen{} 何番目のデータの解像度・計算領域を変換するか. データが必ずしもあるとは限らないので \sphinxtitleref{end\_step=True} が推奨される.

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{xmax}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} max location in x direction

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{xmin}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} min location in x direction

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{ymax}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} max location in y direction

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{ymin}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} min location in y direction

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{zmax}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} max location in z direction

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{zmin}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} min location in z direction

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{endian}} (\sphinxstyleliteralemphasis{\sphinxupquote{char}}) \sphinxhyphen{}\sphinxhyphen{} endian, "\textless{}" もしくは, "\textgreater{}"

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{ix}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}) \sphinxhyphen{}\sphinxhyphen{} updated grid point in x direction

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{jx}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}) \sphinxhyphen{}\sphinxhyphen{} updated grid point in y direction

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{kx}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}) \sphinxhyphen{}\sphinxhyphen{} updated grid point in z direction

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{memory\_saving}} (\sphinxstyleliteralemphasis{\sphinxupquote{bool}}) \sphinxhyphen{}\sphinxhyphen{} If true, upgraded variables are saved in memory separately for saving memory

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{end\_step}} (\sphinxstyleliteralemphasis{\sphinxupquote{bool}}) \sphinxhyphen{}\sphinxhyphen{} \sphinxtitleref{end\_step=True} のときは, パラメータ \sphinxtitleref{n} は無視されて持っている一番最後のステップのデータの解像度・計算領域変更がされる. \sphinxtitleref{end\_step=False} のときは　\sphinxtitleref{n} ステップのデータが利用される.cd .

\end{itemize}

\end{description}\end{quote}

\sphinxAtStartPar
これより下のパラメタは \sphinxtitleref{x\_ununif=True} を用いたときのみ有効となる.
\begin{quote}\begin{description}
\sphinxlineitem{パラメータ}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{ix\_ununi}} (\sphinxstyleliteralemphasis{\sphinxupquote{int}}) \sphinxhyphen{}\sphinxhyphen{} number of grid in uniform grid region

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{dx00}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} grid spacing in uniform grid region

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{x\_ununif}} (\sphinxstyleliteralemphasis{\sphinxupquote{bool}}) \sphinxhyphen{}\sphinxhyphen{} whethere ununiform grid is used

\end{itemize}

\end{description}\end{quote}

\end{fulllineitems}


\sphinxAtStartPar
例えば, \sphinxtitleref{caseid=\textquotesingle{}d001\textquotesingle{}} のデータの解像度を変更して \sphinxtitleref{caseid=\textquotesingle{}d002\textquotesingle{}} へと出力する時は

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{d} \PYG{o}{=} \PYG{n}{R2D2}\PYG{o}{.}\PYG{n}{R2D2\PYGZus{}data}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../run/d001}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{d}\PYG{o}{.}\PYG{n}{upgrade\PYGZus{}resolution}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{d002}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
として, 出力された結果を参考にd002のプログラムを変更する.


\subsection{IDLコード}
\label{\detokenize{io:idl}}
\sphinxAtStartPar
\sphinxhref{https://github.com/hottahd/R2D2\_idl}{GitHubの公開レポジトリ} に簡単な説明あり


\section{バージョン履歴}
\label{\detokenize{io:id8}}\begin{itemize}
\item {} 
\sphinxAtStartPar
ver. 1.0: バージョン制を導入

\item {} 
\sphinxAtStartPar
ver. 1.1: 光学的厚さが0.1, 0.01の部分も出力することにした。qq\_in, vcをconfigのグローバル変数として取扱うことにした。

\item {} 
\sphinxAtStartPar
ver. 1.2: データ構造を変更。

\end{itemize}

\sphinxAtStartPar
最終更新日：2024年04月05日

\sphinxstepscope


\chapter{Paraviewを用いた3Dデータ表示}
\label{\detokenize{paraview:paraview3d}}\label{\detokenize{paraview::doc}}
\sphinxAtStartPar
ここでは、Paraviewを用いてR2D2の計算結果を三次元表示する方法を説明する。


\section{データ準備}
\label{\detokenize{paraview:id1}}
\sphinxAtStartPar
すでに計算を実行していて、何らかのデータが準備できている状況を想定する。
データをParaviewで扱うためにVTKフォーマットに変換する。
変換後に用意するべきデータは
\begin{itemize}
\item {} 
\sphinxAtStartPar
ある物理量の三次元データ

\item {} 
\sphinxAtStartPar
ある物理量の :\(\tau=1\) でのデータ

\end{itemize}

\sphinxAtStartPar
それぞれのデータのためにR2D2 Pythonでは以下の関数が用意してある。
\index{built\sphinxhyphen{}in function@\spxentry{built\sphinxhyphen{}in function}!R2D2.vtk.write\_3D()@\spxentry{R2D2.vtk.write\_3D()}}\index{R2D2.vtk.write\_3D()@\spxentry{R2D2.vtk.write\_3D()}!built\sphinxhyphen{}in function@\spxentry{built\sphinxhyphen{}in function}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{paraview:R2D2.vtk.write_3D}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxcode{\sphinxupquote{R2D2.vtk.}}\sphinxbfcode{\sphinxupquote{write\_3D}}}{\sphinxparam{\DUrole{n}{qq}}\sphinxparamcomma \sphinxparam{\DUrole{n}{x}}\sphinxparamcomma \sphinxparam{\DUrole{n}{y}}\sphinxparamcomma \sphinxparam{\DUrole{n}{z}}\sphinxparamcomma \sphinxparam{\DUrole{n}{file}}\sphinxparamcomma \sphinxparam{\DUrole{n}{name}}}{}
\pysigstopsignatures
\sphinxAtStartPar
3次元のスカラー量をVTKフォーマットで出力するための関数
\begin{quote}\begin{description}
\sphinxlineitem{パラメータ}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{qq}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} 出力したい物理量の3次元numpy配列

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{x}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} x方向の座標

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{y}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} y方向の座標

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{z}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} z方向の座標

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{file}} (\sphinxstyleliteralemphasis{\sphinxupquote{str}}) \sphinxhyphen{}\sphinxhyphen{} 出力先のVTKフォーマットの名前

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{name}} (\sphinxstyleliteralemphasis{\sphinxupquote{str}}) \sphinxhyphen{}\sphinxhyphen{} Paraviewで管理するために用いる出力した物理量の名前

\end{itemize}

\end{description}\end{quote}

\end{fulllineitems}

\index{built\sphinxhyphen{}in function@\spxentry{built\sphinxhyphen{}in function}!R2D2.vtk.write\_vtk.write\_3D\_vector()@\spxentry{R2D2.vtk.write\_vtk.write\_3D\_vector()}}\index{R2D2.vtk.write\_vtk.write\_3D\_vector()@\spxentry{R2D2.vtk.write\_vtk.write\_3D\_vector()}!built\sphinxhyphen{}in function@\spxentry{built\sphinxhyphen{}in function}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{paraview:R2D2.vtk.write_vtk.write_3D_vector}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxcode{\sphinxupquote{R2D2.vtk.write\_vtk.}}\sphinxbfcode{\sphinxupquote{write\_3D\_vector}}}{\sphinxparam{\DUrole{n}{qx}}\sphinxparamcomma \sphinxparam{\DUrole{n}{qy}}\sphinxparamcomma \sphinxparam{\DUrole{n}{qz}}\sphinxparamcomma \sphinxparam{\DUrole{n}{x}}\sphinxparamcomma \sphinxparam{\DUrole{n}{y}}\sphinxparamcomma \sphinxparam{\DUrole{n}{z}}\sphinxparamcomma \sphinxparam{\DUrole{n}{file}}\sphinxparamcomma \sphinxparam{\DUrole{n}{name}}}{}
\pysigstopsignatures
\sphinxAtStartPar
３次元のベクトル量をVTKフォーマットで出力するための関数
\begin{quote}\begin{description}
\sphinxlineitem{パラメータ}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{qx}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} x方向のベクトルの3次元numpy配列

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{qy}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} y方向のベクトルの3次元numpy配列

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{qz}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} z方向のベクトルの3次元numpy配列

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{x}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} x方向の座標

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{y}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} y方向の座標

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{z}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} z方向の座標

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{file}} (\sphinxstyleliteralemphasis{\sphinxupquote{str}}) \sphinxhyphen{}\sphinxhyphen{} 出力先のVTKフォーマットの名前

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{name}} (\sphinxstyleliteralemphasis{\sphinxupquote{str}}) \sphinxhyphen{}\sphinxhyphen{} Paraviewで管理するために用いる出力した物理量の名前

\end{itemize}

\end{description}\end{quote}

\end{fulllineitems}

\index{built\sphinxhyphen{}in function@\spxentry{built\sphinxhyphen{}in function}!R2D2.vtk.write\_optical\_surface()@\spxentry{R2D2.vtk.write\_optical\_surface()}}\index{R2D2.vtk.write\_optical\_surface()@\spxentry{R2D2.vtk.write\_optical\_surface()}!built\sphinxhyphen{}in function@\spxentry{built\sphinxhyphen{}in function}}

\begin{fulllineitems}
\phantomsection\label{\detokenize{paraview:R2D2.vtk.write_optical_surface}}
\pysigstartsignatures
\pysiglinewithargsret{\sphinxcode{\sphinxupquote{R2D2.vtk.}}\sphinxbfcode{\sphinxupquote{write\_optical\_surface}}}{\sphinxparam{\DUrole{n}{qq}}\sphinxparamcomma \sphinxparam{\DUrole{n}{height}}\sphinxparamcomma \sphinxparam{\DUrole{n}{y}}\sphinxparamcomma \sphinxparam{\DUrole{n}{z}}\sphinxparamcomma \sphinxparam{\DUrole{n}{file}}\sphinxparamcomma \sphinxparam{\DUrole{n}{name}}}{}
\pysigstopsignatures
\sphinxAtStartPar
\(\tau=1\) での2次元データを出力するための関数
\begin{quote}\begin{description}
\sphinxlineitem{パラメータ}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{qq}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} 出力したい物理量の2次元配列

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{height}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} \(\tau=1\) の高さの情報。\sphinxcode{\sphinxupquote{self.qt{[}\textquotesingle{}he\textquotesingle{}{]}}} を出力することが想定されている。

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{y}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} y方向の座標

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{z}} (\sphinxstyleliteralemphasis{\sphinxupquote{float}}) \sphinxhyphen{}\sphinxhyphen{} z方向の座標

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{file}} (\sphinxstyleliteralemphasis{\sphinxupquote{str}}) \sphinxhyphen{}\sphinxhyphen{} 出力先VTKフォーマットの名前

\item {} 
\sphinxAtStartPar
\sphinxstyleliteralstrong{\sphinxupquote{name}} (\sphinxstyleliteralemphasis{\sphinxupquote{str}}) \sphinxhyphen{}\sphinxhyphen{} Paraviewで管理するために用いる出力した物理量の名前

\end{itemize}

\end{description}\end{quote}

\end{fulllineitems}


\sphinxAtStartPar
例えば、以下のようにして実行する

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{run} \PYG{n}{init} \PYG{c+c1}{\PYGZsh{}　初期設定}
\PYG{n}{d}\PYG{o}{.}\PYG{n}{read\PYGZus{}qq}\PYG{p}{(}\PYG{l+m+mi}{100}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} 100番目の3次元データを読込}
\PYG{n}{bb} \PYG{o}{=} \PYG{n}{sqrt}\PYG{p}{(}\PYG{n}{d}\PYG{o}{.}\PYG{n}{qq}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bx}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{2} \PYG{o}{+} \PYG{n}{d}\PYG{o}{.}\PYG{n}{qq}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{by}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{2} \PYG{o}{+} \PYG{n}{d}\PYG{o}{.}\PYG{n}{qq}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bz}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{*}\PYG{o}{*}\PYG{l+m+mi}{2}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} 磁場の強さを計算}
\PYG{n}{d}\PYG{o}{.}\PYG{n}{read\PYGZus{}tau}\PYG{p}{(}\PYG{l+m+mi}{100}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} 100番目のtau=1の2次元データを読込}

\PYG{n}{R2D2}\PYG{o}{.}\PYG{n}{vtk}\PYG{o}{.}\PYG{n}{write\PYGZus{}3D}\PYG{p}{(}\PYG{n}{bb}\PYG{p}{,}\PYG{n}{x}\PYG{p}{,}\PYG{n}{y}\PYG{p}{,}\PYG{n}{z}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bb.vtk}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bb}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} 変数名をbbとしてファイル名bb.vtkに3次元データを出力}
\PYG{n}{R2D2}\PYG{o}{.}\PYG{n}{vtk}\PYG{o}{.}\PYG{n}{write\PYGZus{}optical\PYGZus{}surface}\PYG{p}{(}\PYG{n}{d}\PYG{o}{.}\PYG{n}{qt}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{in}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}\PYG{n}{d}\PYG{o}{.}\PYG{n}{qt}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{he}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}\PYG{n}{y}\PYG{p}{,}\PYG{n}{z}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{in.vtk}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{in}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} 変数名をinとしてファイル名in.vtkに2次元データを出力}
\end{sphinxVerbatim}


\section{Paraviewを用いて3次元表示}
\label{\detokenize{paraview:paraview3}}
\sphinxAtStartPar
\sphinxhref{https://www.paraview.org/download/}{Paraviewのサイト} からParaviewをダウンロード。Windows, Linux, macOSのそれぞれのソフトウェアがあるのでインストール方法は各自確認すること。ここでは、macOSでの利用方法を示すが、確認している限りは、Linuxでもほとんど同じ。ここでは非常に簡単にParaviewの使い方を説明する。詳しくはParaviewの公式マニュアルなどを読むこと。
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
まず右上のファイルアイコンをクリック
\begin{quote}

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{paraview01}.png}
\end{quote}

\item {} 
\sphinxAtStartPar
Pythonで生成したファイルを選択。2次元, ３次元ファイルどちらも選択する。一個一個選択しても良いし、一度に選択しても良い。時系列データの時は、すべてを一度に選択するとアニメーションを作りやすい。
\begin{quote}

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{paraview02}.png}
\end{quote}

\item {} 
\sphinxAtStartPar
Applyをクリック。選択した二つのデータが表示される。
\begin{quote}

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{paraview03}.png}
\end{quote}

\item {} 
\sphinxAtStartPar
2次元データの方は、すぐに面として表示されるが、三次元データは表示方法を選ぶ必要がある。
\begin{quote}

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{paraview04}.png}
\end{quote}

\item {} 
\sphinxAtStartPar
三次元データのボリュームレンダリングが行いたいので、Volumeを選ぶ。
\begin{quote}

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{paraview05}.png}
\end{quote}

\item {} 
\sphinxAtStartPar
三次元データのボリュームレンダリングが表示されるので、便宜描画を回転させるなどして、解析する。
\begin{quote}

\noindent\sphinxincludegraphics[width=600\sphinxpxdimen]{{paraview06}.png}
\end{quote}

\end{enumerate}

\sphinxAtStartPar
最終更新日：2024年04月05日

\sphinxstepscope


\chapter{R2D2 pythonでのキーワードの説明}
\label{\detokenize{notation:r2d2-python}}\label{\detokenize{notation::doc}}
\sphinxAtStartPar
以下では、R2D2 pythonで使われている辞書型に含まれるキーの説明を行う
\begin{itemize}
\item {} 
\sphinxAtStartPar
キーの名前 (型) \sphinxhyphen{}\sphinxhyphen{} 説明 {[}単位{]}

\end{itemize}

\sphinxAtStartPar
というフォーマットを採用する。

\sphinxAtStartPar
R2D2では、\sphinxcode{\sphinxupquote{R2D2\_data}} というクラスを用意している。


\section{self.p {[}dictionary{]}}
\label{\detokenize{notation:self-p-dictionary}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{R2D2}
\PYG{n+nb+bp}{self} \PYG{o}{=} \PYG{n}{R2D2}\PYG{o}{.}\PYG{n}{R2D2\PYGZus{}data}\PYG{p}{(}\PYG{n}{datadir}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
とすると、初期設定が読み込まれる。 \sphinxcode{\sphinxupquote{self}} は \sphinxcode{\sphinxupquote{R2D2\_data}} のオブジェクトであり、名前は任意である。 \sphinxcode{\sphinxupquote{init.py}} や \sphinxcode{\sphinxupquote{mov.py}} では、オブジェクト名は \sphinxcode{\sphinxupquote{d}} としてある。


\subsection{出力・時間に関する量}
\label{\detokenize{notation:id1}}\begin{itemize}
\item {} 
\sphinxAtStartPar
datadir (str) \sphinxhyphen{}\sphinxhyphen{} データの保存場所

\item {} 
\sphinxAtStartPar
nd (int) \sphinxhyphen{}\sphinxhyphen{} 現在までのアウトプット時間ステップ数(3次元データ)

\item {} 
\sphinxAtStartPar
nd\_tau (int) \sphinxhyphen{}\sphinxhyphen{} 現在までのアウトプット時間ステップ数(光学的厚さ一定のデータ)

\item {} 
\sphinxAtStartPar
dtout (float) \sphinxhyphen{}\sphinxhyphen{}　出力ケーデンス {[}s{]}

\item {} 
\sphinxAtStartPar
dtout\_tau (float) \sphinxhyphen{}\sphinxhyphen{}　光学的厚さ一定のデータの出力ケーデンス {[}s{]}

\item {} 
\sphinxAtStartPar
ifac (int) \sphinxhyphen{}\sphinxhyphen{} dtout/dtout\_tau

\item {} 
\sphinxAtStartPar
tend (float) \sphinxhyphen{}\sphinxhyphen{} 計算終了時間。大きく取ってあるためにこの時間まで計算することはあまりない {[}s{]}

\item {} 
\sphinxAtStartPar
swap (int) \sphinxhyphen{}\sphinxhyphen{}　エンディアン指定。big endianは1、little endianは0。IDLの定義に従っている。

\item {} 
\sphinxAtStartPar
endian (char) \sphinxhyphen{}\sphinxhyphen{} エンディアン指定。big endianは \textgreater{} 、little endianは \textless{} 。pythonの定義に従っている。

\item {} 
\sphinxAtStartPar
m\_in (int) \sphinxhyphen{}\sphinxhyphen{} 光学的厚さ一定のデータを出力する変数の数

\item {} 
\sphinxAtStartPar
m\_tu (int) \sphinxhyphen{}\sphinxhyphen{} 光学的厚さ一定のデータの層の数

\end{itemize}


\subsection{座標に関する量}
\label{\detokenize{notation:id2}}\begin{itemize}
\item {} 
\sphinxAtStartPar
xdcheck (int) \sphinxhyphen{}\sphinxhyphen{} x軸方向に解いているか。解いていたら2、解いていなかったら1

\item {} 
\sphinxAtStartPar
ydcheck (int) \sphinxhyphen{}\sphinxhyphen{} y軸方向に解いているか。解いていたら2、解いていなかったら1

\item {} 
\sphinxAtStartPar
zdcheck (int) \sphinxhyphen{}\sphinxhyphen{} z軸方向に解いているか。解いていたら2、解いていなかったら1

\item {} 
\sphinxAtStartPar
margin (int) \sphinxhyphen{}\sphinxhyphen{} マージン(ゴーストセル)の数

\item {} 
\sphinxAtStartPar
nx (int) \sphinxhyphen{}\sphinxhyphen{} 1 MPIスレッドあたりのx方向の格子点の数

\item {} 
\sphinxAtStartPar
ny (int) \sphinxhyphen{}\sphinxhyphen{} 1 MPIスレッドあたりのy方向の格子点の数

\item {} 
\sphinxAtStartPar
nz (int) \sphinxhyphen{}\sphinxhyphen{} 1 MPIスレッドあたりのz方向の格子点の数

\item {} 
\sphinxAtStartPar
ix0 (int) \sphinxhyphen{}\sphinxhyphen{} x方向のMPI領域分割の数

\item {} 
\sphinxAtStartPar
jx0 (int) \sphinxhyphen{}\sphinxhyphen{} y方向のMPI領域分割の数

\item {} 
\sphinxAtStartPar
kx0 (int) \sphinxhyphen{}\sphinxhyphen{} z方向のMPI領域分割の数

\item {} 
\sphinxAtStartPar
ix (int) \sphinxhyphen{}\sphinxhyphen{} x方向の格子点数 ix0*nx

\item {} 
\sphinxAtStartPar
jx (int) \sphinxhyphen{}\sphinxhyphen{} y方向の格子点数 jx0*ny

\item {} 
\sphinxAtStartPar
kx (int) \sphinxhyphen{}\sphinxhyphen{} z方向の格子点数 kx0*nz

\item {} 
\sphinxAtStartPar
npe (int) \sphinxhyphen{}\sphinxhyphen{} 全MPIスレッドの数 \sphinxcode{\sphinxupquote{npe = ix0*jx0*kx0}}

\item {} 
\sphinxAtStartPar
mtype (int) \sphinxhyphen{}\sphinxhyphen{} 変数の数

\item {} 
\sphinxAtStartPar
xmax (float) \sphinxhyphen{}\sphinxhyphen{} x方向境界の位置(上限値)　{[}cm{]}

\item {} 
\sphinxAtStartPar
xmin (float) \sphinxhyphen{}\sphinxhyphen{} x方向境界の位置(下限値)　{[}cm{]}

\item {} 
\sphinxAtStartPar
ymax (float) \sphinxhyphen{}\sphinxhyphen{} y方向境界の位置(上限値)　{[}cm{]}

\item {} 
\sphinxAtStartPar
ymin (float) \sphinxhyphen{}\sphinxhyphen{} y方向境界の位置(下限値)　{[}cm{]}

\item {} 
\sphinxAtStartPar
zmax (float) \sphinxhyphen{}\sphinxhyphen{} z方向境界の位置(上限値)　{[}cm{]}

\item {} 
\sphinxAtStartPar
zmin (float) \sphinxhyphen{}\sphinxhyphen{} z方向境界の位置(下限値)　{[}cm{]}

\item {} 
\sphinxAtStartPar
x (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} x方向の座標 {[}cm{]}

\item {} 
\sphinxAtStartPar
y (float) {[}jx{]} \sphinxhyphen{}\sphinxhyphen{} y方向の座標 {[}cm{]}

\item {} 
\sphinxAtStartPar
z (float) {[}kx{]} \sphinxhyphen{}\sphinxhyphen{} z方向の座標 {[}cm{]}

\item {} 
\sphinxAtStartPar
xr (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} x/rsun

\item {} 
\sphinxAtStartPar
xn (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} \sphinxcode{\sphinxupquote{(x\sphinxhyphen{}rsun)*1.e\sphinxhyphen{}8}}

\item {} 
\sphinxAtStartPar
deep\_top\_flag (int) \sphinxhyphen{}\sphinxhyphen{}

\item {} 
\sphinxAtStartPar
ib\_excluded\_top (int) \sphinxhyphen{}\sphinxhyphen{}

\item {} 
\sphinxAtStartPar
rsun (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 太陽半径 {[}cm{]}

\end{itemize}


\subsection{背景場に関する量}
\label{\detokenize{notation:id3}}\begin{itemize}
\item {} 
\sphinxAtStartPar
pr0 (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 背景場の圧力 {[}dyn cm $^{\text{\sphinxhyphen{}2}}${]}

\item {} 
\sphinxAtStartPar
te0 (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 背景場の温度 {[}K{]}

\item {} 
\sphinxAtStartPar
ro0 (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 背景場の密度 {[}g cm $^{\text{\sphinxhyphen{}3}}${]}

\item {} 
\sphinxAtStartPar
se0 (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 背景場のエントロピー {[}erg g $^{\text{\sphinxhyphen{}1}}$ K $^{\text{\sphinxhyphen{}1}}${]}

\item {} 
\sphinxAtStartPar
en0 (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 背景場の内部エネルギー {[}erg cm $^{\text{\sphinxhyphen{}3}}${]}

\item {} 
\sphinxAtStartPar
op0 (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 背景場のオパシティー {[}g $^{\text{\sphinxhyphen{}1}}$ cm $^{\text{\sphinxhyphen{}2}}${]}

\item {} 
\sphinxAtStartPar
tu0 (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 背景場の光学的厚さ

\item {} 
\sphinxAtStartPar
dsedr0 (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 背景場の鉛直エントロピー勾配 {[}erg g $^{\text{\sphinxhyphen{}1}}$ K $^{\text{\sphinxhyphen{}1}}$ cm $^{\text{\sphinxhyphen{}1}}${]}

\item {} 
\sphinxAtStartPar
dtedr0 (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 背景場の鉛直温度勾配 {[}K cm $^{\text{\sphinxhyphen{}1}}${]}

\item {} 
\sphinxAtStartPar
dprdro (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 背景場の \((\partial p/\partial \rho)_s\)

\item {} 
\sphinxAtStartPar
dprdse (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 背景場の \((\partial p/\partial s)_\rho\)

\item {} 
\sphinxAtStartPar
dtedro (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 背景場の \((\partial T/\partial \rho)_s\)

\item {} 
\sphinxAtStartPar
dtedse (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 背景場の \((\partial T/\partial s)_\rho\)

\item {} 
\sphinxAtStartPar
dendro (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 背景場の \((\partial e/\partial \rho)_s\)

\item {} 
\sphinxAtStartPar
dendse (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 背景場の \((\partial e/\partial s)_\rho\)

\item {} 
\sphinxAtStartPar
gx (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 重力加速度 {[}cm s $^{\text{\sphinxhyphen{}2}}${]}

\item {} 
\sphinxAtStartPar
kp (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 放射拡散係数 {[}cm $^{\text{2}}$ s $^{\text{\sphinxhyphen{}1}}${]}

\item {} 
\sphinxAtStartPar
cp (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 定圧比熱　{[}erg g $^{\text{\sphinxhyphen{}1}}$ K $^{\text{\sphinxhyphen{}1}}${]}

\item {} 
\sphinxAtStartPar
fa (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 対流層の底付近の輻射によるエネルギーフラックス。光球付近では輻射輸送を直に解くために含まれないが、上部境界が光球にない場合は、上部境界付近の人工的なエネルギーフラックス(冷却が含まれる) {[}erg cm $^{\text{\sphinxhyphen{}2}}${]}

\item {} 
\sphinxAtStartPar
sa (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 上記faによる加熱率 {[}erg cm $^{\text{\sphinxhyphen{}3}}${]}

\item {} 
\sphinxAtStartPar
xi (float) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} 音速抑制率

\item {} 
\sphinxAtStartPar
ix\_e (int) \sphinxhyphen{}\sphinxhyphen{} 状態方程式の密度の格子点数

\item {} 
\sphinxAtStartPar
jx\_e (int) \sphinxhyphen{}\sphinxhyphen{} 状態方程式のエントロピーの格子点数

\end{itemize}


\subsection{解析のためのデータ再配置(remap)に関する量}
\label{\detokenize{notation:remap}}\begin{itemize}
\item {} 
\sphinxAtStartPar
m2da (int) \sphinxhyphen{}\sphinxhyphen{} remapで出力した解析量の数

\item {} 
\sphinxAtStartPar
cl (char) {[}m2da{]} \sphinxhyphen{}\sphinxhyphen{}　remapで出力した解析量の名前

\item {} 
\sphinxAtStartPar
jc (int) \sphinxhyphen{}\sphinxhyphen{} \sphinxcode{\sphinxupquote{self.vc{[}\textquotesingle{}vxp\textquotesingle{}{]}}} などで出力するスライスのy方向の位置

\item {} 
\sphinxAtStartPar
kc (int) \sphinxhyphen{}\sphinxhyphen{} 浮上磁場の中心と思っている場所を出力(あまり使わない)

\item {} 
\sphinxAtStartPar
ixr (int) \sphinxhyphen{}\sphinxhyphen{} remap後のx方向分割の数

\item {} 
\sphinxAtStartPar
jxr (int) \sphinxhyphen{}\sphinxhyphen{} remap後のy方向分割の数

\item {} 
\sphinxAtStartPar
iss (int) {[}npe{]} \sphinxhyphen{}\sphinxhyphen{} remap後配列のそれぞれのMPIプロセスのx方向の初めの位置

\item {} 
\sphinxAtStartPar
iee (int) {[}npe{]} \sphinxhyphen{}\sphinxhyphen{} remap後配列のそれぞれのMPIプロセスのx方向の終わりの位置

\item {} 
\sphinxAtStartPar
jss (int) {[}npe{]} \sphinxhyphen{}\sphinxhyphen{} remap後配列のそれぞれのMPIプロセスのy方向の初めの位置

\item {} 
\sphinxAtStartPar
jee (int) {[}npe{]} \sphinxhyphen{}\sphinxhyphen{} remap後配列のそれぞれのMPIプロセスのy方向の終わりの位置

\item {} 
\sphinxAtStartPar
iixl (int) {[}npe{]} \sphinxhyphen{}\sphinxhyphen{} remap後配列のそれぞれのMPIプロセスのx方向の格子点数

\item {} 
\sphinxAtStartPar
jjxl (int) {[}npe{]} \sphinxhyphen{}\sphinxhyphen{} remap後配列のそれぞれのMPIプロセスのy方向の格子点数

\item {} 
\sphinxAtStartPar
np\_ijr (int) {[}npe{]} \sphinxhyphen{}\sphinxhyphen{} x, y方向のMPIプロセスの位置を入力するとMPIプロセス番号を返す配列

\item {} 
\sphinxAtStartPar
ir (int) {[}npe{]} \sphinxhyphen{}\sphinxhyphen{} MPIプロセス番号を入れるとx方向のMPIプロセスの位置を返す配列

\item {} 
\sphinxAtStartPar
jr (int) {[}npe{]} \sphinxhyphen{}\sphinxhyphen{} MPIプロセス番号を入れるとy方向のMPIプロセスの位置を返す配列

\item {} 
\sphinxAtStartPar
i2ir (int) {[}ix{]} \sphinxhyphen{}\sphinxhyphen{} x方向の格子点の位置を入れるとx方向のMPIプロセスの位置を返す配列

\item {} 
\sphinxAtStartPar
j2jr (int) {[}jx{]} \sphinxhyphen{}\sphinxhyphen{} y方向の格子点の位置を入れるとy方向のMPIプロセスの位置を返す配列

\end{itemize}


\subsection{スライスデータに関する量}
\label{\detokenize{notation:id4}}\begin{itemize}
\item {} 
\sphinxAtStartPar
nx\_slice {[}int{]} \sphinxhyphen{}\sphinxhyphen{} x一定面のスライスの数

\item {} 
\sphinxAtStartPar
ny\_slice {[}int{]} \sphinxhyphen{}\sphinxhyphen{} y一定面のスライスの数

\item {} 
\sphinxAtStartPar
nz\_slice {[}int{]} \sphinxhyphen{}\sphinxhyphen{} z一定面のスライスの数

\item {} 
\sphinxAtStartPar
x\_slice {[}float{]} \sphinxhyphen{}\sphinxhyphen{} x一定面のスライスの位置 {[}cm{]}

\item {} 
\sphinxAtStartPar
y\_slice {[}float{]} \sphinxhyphen{}\sphinxhyphen{} y一定面のスライスの位置 {[}cm{]}

\item {} 
\sphinxAtStartPar
z\_slice {[}float{]} \sphinxhyphen{}\sphinxhyphen{} z一定面のスライスの位置 {[}cm{]}

\end{itemize}


\section{self.qs {[}dictionary{]}}
\label{\detokenize{notation:self-qs-dictionary}}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{xs} \PYG{o}{=} \PYG{l+m+mf}{0.99}\PYG{o}{*}\PYG{n}{rsun}
\PYG{n}{ns} \PYG{o}{=} \PYG{l+m+mi}{10}
\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{read\PYGZus{}qq\PYGZus{}select}\PYG{p}{(}\PYG{n}{xs}\PYG{p}{,}\PYG{n}{ns}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
として高さ \sphinxcode{\sphinxupquote{xs}} での二次元スライスを読み込む
\begin{itemize}
\item {} 
\sphinxAtStartPar
ro (float) {[}jx,kx{]} \sphinxhyphen{}\sphinxhyphen{} 密度の擾乱 \(\rho_1\) {[}g cm $^{\text{\sphinxhyphen{}3}}${]}

\item {} 
\sphinxAtStartPar
vx (float) {[}jx,kx{]} \sphinxhyphen{}\sphinxhyphen{} x方向の速度 \(v_x\) {[}cm s $^{\text{\sphinxhyphen{}1}}${]}

\item {} 
\sphinxAtStartPar
vy (float) {[}jx,kx{]} \sphinxhyphen{}\sphinxhyphen{} y方向の速度 \(v_y\) {[}cm s $^{\text{\sphinxhyphen{}1}}${]}

\item {} 
\sphinxAtStartPar
vz (float) {[}jx,kx{]} \sphinxhyphen{}\sphinxhyphen{} z方向の速度 \(v_z\) {[}cm s $^{\text{\sphinxhyphen{}1}}${]}

\item {} 
\sphinxAtStartPar
bx (float) {[}jx,kx{]} \sphinxhyphen{}\sphinxhyphen{} x方向の磁場 \(B_x\) {[}G{]}

\item {} 
\sphinxAtStartPar
by (float) {[}jx,kx{]} \sphinxhyphen{}\sphinxhyphen{} y方向の磁場 \(B_y\) {[}G{]}

\item {} 
\sphinxAtStartPar
bz (float) {[}jx,kx{]} \sphinxhyphen{}\sphinxhyphen{} z方向の磁場 \(B_z\) {[}G{]}

\item {} 
\sphinxAtStartPar
se (float) {[}jx,kx{]} \sphinxhyphen{}\sphinxhyphen{} エントロピーの擾乱 \(s_1\) {[}erg g $^{\text{\sphinxhyphen{}1}}$ K $^{\text{\sphinxhyphen{}1}}${]}

\item {} 
\sphinxAtStartPar
pr (float) {[}jx,kx{]} \sphinxhyphen{}\sphinxhyphen{} 圧力の擾乱 \(p_1\) {[}dyn cm $^{\text{\sphinxhyphen{}2}}${]}

\item {} 
\sphinxAtStartPar
te (float) {[}jx,kx{]} \sphinxhyphen{}\sphinxhyphen{} 温度の擾乱 \(T_1\) {[}K{]}

\item {} 
\sphinxAtStartPar
op (float) {[}jx,kx{]} \sphinxhyphen{}\sphinxhyphen{} 不透明度(オパシティー) \(\kappa\) {[}g $^{\text{\sphinxhyphen{}1}}$ cm $^{\text{\sphinxhyphen{}2}}${]}

\end{itemize}


\section{self.qq {[}dictionary{]}}
\label{\detokenize{notation:self-qq-dictionary}}
\sphinxAtStartPar
\sphinxcode{\sphinxupquote{self.qs}} と同様


\section{self.qt {[}dictionary{]}}
\label{\detokenize{notation:self-qt-dictionary}}
\sphinxAtStartPar
ほぼself.qsと同様だが、以下の追加量が保存してある。


\section{self.vc {[}dictionary{]}}
\label{\detokenize{notation:self-vc-dictionary}}
\sphinxAtStartPar
数値計算実行時に解析・出力している統計量。しばしばバグがあるので注意すること。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{ns} \PYG{o}{=} \PYG{l+m+mi}{10}
\PYG{n+nb+bp}{self}\PYG{o}{.}\PYG{n}{read\PYGZus{}vc}\PYG{p}{(}\PYG{n}{ns}\PYG{p}{)}
\end{sphinxVerbatim}

\sphinxAtStartPar
として統計量を読み込む.
\begin{itemize}
\item {} 
\sphinxAtStartPar
su, sd (float) {[}ix,jx{]} \sphinxhyphen{}\sphinxhyphen{} ある動径位置 \(r\), 余緯度 \(\theta\) における上昇流(su), 下降流(sd)の格子点数 {[}個{]}

\item {} \begin{description}
\sphinxlineitem{\sphinxcode{\sphinxupquote{**m}} と表されるものは経度方向平均。以下の物理量がある}\begin{itemize}
\item {} 
\sphinxAtStartPar
rom (float) {[}ix,jx{]} \sphinxhyphen{}\sphinxhyphen{} 密度　{[}g cm $^{\text{\sphinxhyphen{}3}}${]}

\item {} 
\sphinxAtStartPar
vxm (float) {[}ix,jx{]} \sphinxhyphen{}\sphinxhyphen{} x方向の速度 {[}cm s $^{\text{\sphinxhyphen{}1}}${]}

\item {} 
\sphinxAtStartPar
vym (float) {[}ix,jx{]} \sphinxhyphen{}\sphinxhyphen{} y方向の速度 {[}cm s $^{\text{\sphinxhyphen{}1}}${]}

\item {} 
\sphinxAtStartPar
vzm (float) {[}ix,jx{]} \sphinxhyphen{}\sphinxhyphen{} z方向の速度 {[}cm s $^{\text{\sphinxhyphen{}1}}${]}

\item {} 
\sphinxAtStartPar
rxm (float) {[}ix,jx{]} \sphinxhyphen{}\sphinxhyphen{} x方向の運動量 :\(\rho v_x\)  {[}g cm $^{\text{\sphinxhyphen{}2}}$ s $^{\text{\sphinxhyphen{}1}}${]}

\item {} 
\sphinxAtStartPar
rym (float) {[}ix,jx{]} \sphinxhyphen{}\sphinxhyphen{} y方向の運動量 :\(\rho v_x\)  {[}g cm $^{\text{\sphinxhyphen{}2}}$ s $^{\text{\sphinxhyphen{}1}}${]}

\item {} 
\sphinxAtStartPar
rzm (float) {[}ix,jx{]} \sphinxhyphen{}\sphinxhyphen{} z方向の運動量 :\(\rho v_x\)  {[}g cm $^{\text{\sphinxhyphen{}2}}$ s $^{\text{\sphinxhyphen{}1}}${]}

\item {} 
\sphinxAtStartPar
bxm (float) {[}ix,jx{]} \sphinxhyphen{}\sphinxhyphen{} x方向の磁場 {[}G{]}

\item {} 
\sphinxAtStartPar
bym (float) {[}ix,jx{]} \sphinxhyphen{}\sphinxhyphen{} y方向の磁場 {[}G{]}

\item {} 
\sphinxAtStartPar
bzm (float) {[}ix,jx{]} \sphinxhyphen{}\sphinxhyphen{} z方向の磁場 {[}G{]}

\end{itemize}

\end{description}

\item {} 
\sphinxAtStartPar
{\color{red}\bfseries{}\textasciigrave{}}{\color{red}\bfseries{}**}rms\textasciigrave{}と表されるものは、経度に対するRMS量

\end{itemize}

\sphinxAtStartPar
最終更新日：2024年04月05日

\sphinxstepscope


\chapter{Sphinx使用の覚書}
\label{\detokenize{sphinx:sphinx}}\label{\detokenize{sphinx::doc}}

\section{はじめに}
\label{\detokenize{sphinx:id1}}
\sphinxAtStartPar
Sphinxは、reStructuredTextからHTMLやLatexなどの
文章を生成するソフトウェアである。
\sphinxhref{https://www.sphinx-doc.org/ja/master/index.html}{Sphinxの公式サイト}
最近ではMarkdownでも記述できるが、結局最後のところはreStructuredTextで記述することになるので、現状では、Markdownは使用していない。このウェブサイトもSphinxで生成しているので、覚書をここに記す。


\section{インストール}
\label{\detokenize{sphinx:id3}}
\sphinxAtStartPar
ここではAnacondaがすでにインストールしてあるMac
にSphinxをインストールすることを考える。
基本的には以下のコマンドを実行するのみである。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
pip\PYG{+w}{ }install\PYG{+w}{ }sphinx
\end{sphinxVerbatim}

\sphinxAtStartPar
Markdownを使いたい時は以下のようにする。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
pip\PYG{+w}{ }install\PYG{+w}{ }commonmark\PYG{+w}{ }recommonmark
\end{sphinxVerbatim}


\section{HTMLファイルの生成}
\label{\detokenize{sphinx:html}}
\sphinxAtStartPar
適当なディレクトリを作成(ここでは \sphinxcode{\sphinxupquote{test}} )とする。
そこで、 \sphinxcode{\sphinxupquote{sphinx\sphinxhyphen{}quickstart}} コマンドによりSphinxで作るドキュメントの
初期設定を行う。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
mkdir\PYG{+w}{ }\PYG{n+nb}{test}\PYG{+w}{ }\PYG{c+c1}{\PYGZsh{} ディレクトリ作成}
\PYG{n+nb}{cd}\PYG{+w}{ }\PYG{n+nb}{test}\PYG{+w}{    }\PYG{c+c1}{\PYGZsh{} ディレクトリに移動}
sphinx\PYGZhy{}quickstart
\end{sphinxVerbatim}

\sphinxAtStartPar
いくつか質問をされる。基本的には読めばわかる質問であるが
少し戸惑う質問を以下にあげる。
\begin{itemize}
\item {} 
\sphinxAtStartPar
プロジェクトのリリース: 1.0などとversionを答える。後に \sphinxcode{\sphinxupquote{conf.py}} を編集すれば変更可能

\item {} 
\sphinxAtStartPar
プロジェクトの言語: デフォルトは英語の \sphinxcode{\sphinxupquote{en}} であるが、日本語を使いたい時は \sphinxcode{\sphinxupquote{ja}} とする

\end{itemize}


\section{VS codeの利用}
\label{\detokenize{sphinx:vs-code}}
\sphinxAtStartPar
VS codeを利用すると快適にreStructuredTextを作成することができる。
\sphinxcode{\sphinxupquote{*.rst}} ファイルをVS codeで開くと自動で確認されるが、以下のプラグインをインストールする。

\noindent\sphinxincludegraphics[width=500\sphinxpxdimen]{{restructuredtext_vs}.png}

\sphinxAtStartPar
\sphinxcode{\sphinxupquote{Cmd+k Cmd+r}} で画面を分割してプレビューできる。正しい \sphinxcode{\sphinxupquote{conf.py}} の場所を設定する必要がある。


\section{環境設定}
\label{\detokenize{sphinx:id4}}
\sphinxAtStartPar
デフォルトの設定では、数式を書く時にMathjaxを使用するようで、数式の太字が意図するように表示されなかったのでsvgで出力することにした。
以下のように　\sphinxcode{\sphinxupquote{conf.py}} に追記する。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{extensions} \PYG{o}{+}\PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sphinx.ext.imgmath}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{imgmath\PYGZus{}image\PYGZus{}format} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{svg}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{imgmath\PYGZus{}font\PYGZus{}size} \PYG{o}{=} \PYG{l+m+mi}{14}
\PYG{n}{pngmath\PYGZus{}latex}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{platex}\PYG{l+s+s1}{\PYGZsq{}}
\end{sphinxVerbatim}

\sphinxAtStartPar
また、ウェブサイトのテーマを変更することもできる。どのようなテーマがあるかは
\sphinxhref{https://sphinx-users.jp/cookbook/changetheme/index.html}{Sphinxのテーマ}
を参照。好きなテーマを選んで \sphinxcode{\sphinxupquote{conf.py}} に以下のように設定。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{html\PYGZus{}theme} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bizstyle}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{html\PYGZus{}theme\PYGZus{}options} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{maincolor}\PYG{l+s+s1}{\PYGZsq{}} \PYG{p}{:} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}696969}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{\PYGZcb{}}
\end{sphinxVerbatim}

\sphinxAtStartPar
今後変更の余地あり。


\section{記法}
\label{\detokenize{sphinx:id6}}

\subsection{リンク}
\label{\detokenize{sphinx:id7}}\begin{itemize}
\item {} 
\sphinxAtStartPar
外部ウェブサイト

\end{itemize}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{l+s}{`Twitter }\PYG{l+s+si}{\PYGZlt{}https://twitter.com\PYGZgt{}}\PYG{l+s}{`\PYGZus{}}
\end{sphinxVerbatim}

\sphinxAtStartPar
などとすると
\begin{quote}

\sphinxAtStartPar
\sphinxhref{https://twitter.com}{Twitter}
\end{quote}

\sphinxAtStartPar
とリンクが生成される
\begin{itemize}
\item {} 
\sphinxAtStartPar
内部サイト

\end{itemize}

\sphinxAtStartPar
自分で作成しているドキュメントをリンクするには

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n+na}{:doc:}\PYG{n+nv}{`index`}
\end{sphinxVerbatim}

\sphinxAtStartPar
などとすると
\begin{quote}

\sphinxAtStartPar
{\hyperref[\detokenize{index::doc}]{\sphinxcrossref{\DUrole{doc}{R2D2マニュアル}}}}
\end{quote}

\sphinxAtStartPar
とリンクが生成される。


\subsection{コード}
\label{\detokenize{sphinx:id8}}
\sphinxAtStartPar
Sphinxでは、コードを直接記載することができる。また、言語に合わせてハイライトも可能。
コードの表記に選択できる言語は \sphinxhref{https://pygments.org/docs/lexers/}{Pygments} にまとめてある。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{code}\PYG{p}{::} \PYG{k}{fortran}

    \PYG{k}{implicit }\PYG{k}{none}
    \PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{o}{=}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{a}\PYG{p}{,}\PYG{n}{b}\PYG{p}{,}\PYG{n}{c}

    \PYG{n}{a}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{1.d0}
    \PYG{n}{b}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{2.d0}
    \PYG{n}{c}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{a}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{n}{b}
\end{sphinxVerbatim}

\sphinxAtStartPar
このようにすると、以下のように表示される

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{implicit }\PYG{k}{none}
\PYG{k+kt}{real}\PYG{p}{(}\PYG{n+nb}{KIND}\PYG{o}{=}\PYG{l+m+mf}{0.d0}\PYG{p}{)}\PYG{+w}{ }\PYG{k+kd}{::}\PYG{+w}{ }\PYG{n}{a}\PYG{p}{,}\PYG{n}{b}\PYG{p}{,}\PYG{n}{c}

\PYG{n}{a}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{1.d0}
\PYG{n}{b}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{l+m+mf}{2.d0}
\PYG{n}{c}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{a}\PYG{+w}{ }\PYG{o}{+}\PYG{+w}{ }\PYG{n}{b}
\end{sphinxVerbatim}


\subsection{画像}
\label{\detokenize{sphinx:id9}}
\sphinxAtStartPar
画像の挿入には \sphinxcode{\sphinxupquote{image}} ディレクティブを使う。オプションで、画像サイズなどを調整できる。堀田はだいたいwidthで調整している。

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{image}\PYG{p}{::} source/figs/R2D2\PYGZus{}logo.png
    \PYG{n+nc}{:width:} 350 px
\end{sphinxVerbatim}

\sphinxAtStartPar
とすると下記のように画像が挿入される。

\noindent\sphinxincludegraphics[width=350\sphinxpxdimen]{{R2D2_logo}.png}


\subsection{数式}
\label{\detokenize{sphinx:id10}}
\sphinxAtStartPar
SphinxではLatexを用いて数式を記述することができる。
1行の独立した数式を取り扱うときは

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{..}  \PYG{o+ow}{math}\PYG{p}{::}

    \PYGZbs{}frac\PYGZob{}\PYGZbs{}partial \PYGZbs{}rho\PYGZcb{}\PYGZob{}\PYGZbs{}partial t\PYGZcb{} = \PYGZhy{}\PYGZbs{}nabla\PYGZbs{}cdot \PYGZbs{}left(\PYGZbs{}rho \PYGZob{}\PYGZbs{}boldsymbol v\PYGZcb{}\PYGZbs{}right)
\end{sphinxVerbatim}

\sphinxAtStartPar
とすると以下のように表示される。
\begin{quote}
\begin{equation*}
\begin{split}\frac{\partial \rho}{\partial t} = -\nabla\cdot \left(\rho {\boldsymbol v}\right)\end{split}
\end{equation*}\end{quote}

\sphinxAtStartPar
インラインの数式では

\begin{sphinxVerbatim}[commandchars=\\\{\}]
ここで \PYG{n+na}{:math:}\PYG{n+nv}{`\PYGZbs{}rho\PYGZus{}1=x\PYGZca{}2`} とする
\end{sphinxVerbatim}

\sphinxAtStartPar
とすると
\begin{quote}

\sphinxAtStartPar
ここで \(\rho_1=x^2\) とする
\end{quote}

\sphinxAtStartPar
と表示される。


\subsection{To DO}
\label{\detokenize{sphinx:to-do}}
\sphinxAtStartPar
To Doを書いておきたい場所に

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{p}{..} \PYG{o+ow}{todo}\PYG{p}{::} 方程式を書く
\end{sphinxVerbatim}

\sphinxAtStartPar
と書くと、To Doが示される。トップページに

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+cp}{.. todolist:}
\end{sphinxVerbatim}

\sphinxAtStartPar
と書いてあるので、To Doのまとめが示されている。

\sphinxAtStartPar
最終更新日：2024年04月05日


\chapter{ライセンス}
\label{\detokenize{index:id1}}
\sphinxAtStartPar
R2D2は公開ソフトウェアではなく、再配布も禁じている。
共同研究者のみが使って良いというルールになっており、R2D2の使用には、以下の規約を守る必要がある。
\begin{itemize}
\item {} 
\sphinxAtStartPar
再配布しない

\item {} 
\sphinxAtStartPar
改変は許されるが、その時の実行結果について堀田は責任を持たない

\item {} 
\sphinxAtStartPar
R2D2で実行する計算は、堀田と議論する必要がある。パラメタ変更などの細かい変更には相談する必要はないが、新しいプロジェクトを開始するときはその都度相談すること。堀田自身のプロジェクト、堀田の指導学生のプロジェクトとの重複を避けるためである。

\item {} 
\sphinxAtStartPar
R2D2を用いた論文を出版するときは \sphinxhref{https://ui.adsabs.harvard.edu/abs/2019SciA....5.2307H/abstract}{Hotta et al., 2019}, \sphinxhref{https://ui.adsabs.harvard.edu/abs/2020MNRAS.494.2523H/abstract}{Hotta and Iijima, 2020} を引用すること。

\item {} 
\sphinxAtStartPar
R2D2を用いた研究を発表するときは、\sphinxhref{https://hottahd.github.io/R2D2-manual/\_images/R2D2\_logo\_red.png}{R2D2のロゴ} の使用が推奨される(強制ではない)。

\end{itemize}

\sphinxAtStartPar
改訂履歴


\chapter{出版論文}
\label{\detokenize{index:id3}}
\sphinxAtStartPar
R2D2を用いた研究で出版された論文は以下です。
\begin{enumerate}
\sphinxsetlistlabels{\arabic}{enumi}{enumii}{}{.}%
\item {} 
\sphinxAtStartPar
\sphinxhref{https://ui.adsabs.harvard.edu/abs/2019SciA....5.2307H/abstract}{Hotta, Iijima, and Kusano, 2019, Science Advances, 5, eaau2307}

\item {} 
\sphinxAtStartPar
\sphinxhref{https://ui.adsabs.harvard.edu/abs/2019ApJ...886L..21T/abstract}{Toriumi and Hotta, 2019, ApJ, 886, L21}

\item {} 
\sphinxAtStartPar
\sphinxhref{https://ui.adsabs.harvard.edu/abs/2020MNRAS.494.2523H/abstract}{Hotta and Iijima, 2020, MNRAS, 494, 2523}

\item {} 
\sphinxAtStartPar
\sphinxhref{https://ui.adsabs.harvard.edu/abs/2020MNRAS.498.2925H/abstract}{Hotta and Toriumi, 2020, MNRAS, 498, 2925}

\item {} 
\sphinxAtStartPar
\sphinxhref{https://ui.adsabs.harvard.edu/abs/2021MNRAS.503.3610T/abstract}{Takahata, Hotta, Iida, and Oba, MNRAS, 503, 3610}

\item {} 
\sphinxAtStartPar
\sphinxhref{https://ui.adsabs.harvard.edu/abs/2021NatAs...5.1100H/abstract}{Hotta and Kusano, 2021, Nature Astronomy, 5, 1100}

\item {} 
\sphinxAtStartPar
\sphinxhref{https://ui.adsabs.harvard.edu/abs/2022ApJ...933..199H/abstract}{Hotta, Kusano, and Shimada, 2022, ApJ, 933, 2}

\item {} 
\sphinxAtStartPar
\sphinxhref{https://ui.adsabs.harvard.edu/abs/2023MNRAS.519.3091M/abstract}{Mori and Hotta, 2023, MNRAS, 519, 3091}

\item {} 
\sphinxAtStartPar
\sphinxhref{https://ui.adsabs.harvard.edu/abs/2022MNRAS.517.2775K/abstract}{Kaneko, Hotta, Toriumi and Kusano, 2022, MNRAS, 517, 2775}

\item {} 
\sphinxAtStartPar
\sphinxhref{https://ui.adsabs.harvard.edu/abs/2023MNRAS.524.4746M/abstract}{Mori and Hotta, 2023, MNRAS, 524, 4746}

\item {} 
\sphinxAtStartPar
\sphinxhref{https://ui.adsabs.harvard.edu/abs/2023NatSR..13.8994T/abstract}{Toriumi, Hotta and Kusano, 2023, Scientific Report, 13, 8994}

\item {} 
\sphinxAtStartPar
\sphinxhref{https://ui.adsabs.harvard.edu/abs/2023PASJ..tmp...76M/abstract}{Masaki, Hotta, Katsukawa and Ishikawa, 2023, PASJ,}

\item {} 
\sphinxAtStartPar
\sphinxhref{https://ui.adsabs.harvard.edu/abs/2023ApJ...948L..24S/abstract}{Silva et al., 2023, ApJ, 948, L24}

\end{enumerate}


\chapter{賞}
\label{\detokenize{index:id4}}\begin{itemize}
\item {} 
\sphinxAtStartPar
\sphinxhref{https://www.hpci-c.jp/hrdevelop/award.html}{HPCI ソフトウェア賞}

\end{itemize}


\chapter{索引と検索ページ}
\label{\detokenize{index:id5}}\begin{itemize}
\item {} 
\sphinxAtStartPar
\DUrole{xref,std,std-ref}{genindex}

\item {} 
\sphinxAtStartPar
\DUrole{xref,std,std-ref}{search}

\end{itemize}


\chapter{TODOリスト}
\label{\detokenize{index:todo}}
\begin{sphinxadmonition}{note}{課題:}
\sphinxAtStartPar
人工粘性
\end{sphinxadmonition}

\sphinxAtStartPar
({\hyperref[\detokenize{artdif:id2}]{\sphinxcrossref{\sphinxstyleemphasis{元のエントリ}}}} は、 /Users/hotta/Library/CloudStorage/Dropbox/work/R2D2/R2D2\sphinxhyphen{}manual/artdif.rst の 4 行目です)

\begin{sphinxadmonition}{note}{課題:}
\sphinxAtStartPar
コーディングルール
\end{sphinxadmonition}

\sphinxAtStartPar
({\hyperref[\detokenize{code:id3}]{\sphinxcrossref{\sphinxstyleemphasis{元のエントリ}}}} は、 /Users/hotta/Library/CloudStorage/Dropbox/work/R2D2/R2D2\sphinxhyphen{}manual/code.rst の 6 行目です)

\begin{sphinxadmonition}{note}{課題:}
\sphinxAtStartPar
コード構造
\end{sphinxadmonition}

\sphinxAtStartPar
({\hyperref[\detokenize{code:id5}]{\sphinxcrossref{\sphinxstyleemphasis{元のエントリ}}}} は、 /Users/hotta/Library/CloudStorage/Dropbox/work/R2D2/R2D2\sphinxhyphen{}manual/code.rst の 10 行目です)

\begin{sphinxadmonition}{note}{課題:}
\sphinxAtStartPar
輻射輸送の方程式
\end{sphinxadmonition}

\sphinxAtStartPar
({\hyperref[\detokenize{equation:id4}]{\sphinxcrossref{\sphinxstyleemphasis{元のエントリ}}}} は、 /Users/hotta/Library/CloudStorage/Dropbox/work/R2D2/R2D2\sphinxhyphen{}manual/equation.rst の 43 行目です)

\begin{sphinxadmonition}{note}{課題:}
\sphinxAtStartPar
パラメータ。どのグローバル変数がどのモジュールで定義されているかを整理する。
\end{sphinxadmonition}

\sphinxAtStartPar
({\hyperref[\detokenize{parameter:id2}]{\sphinxcrossref{\sphinxstyleemphasis{元のエントリ}}}} は、 /Users/hotta/Library/CloudStorage/Dropbox/work/R2D2/R2D2\sphinxhyphen{}manual/parameter.rst の 4 行目です)

\begin{sphinxadmonition}{note}{課題:}
\sphinxAtStartPar
数値スキーム(時間積分)
\end{sphinxadmonition}

\sphinxAtStartPar
({\hyperref[\detokenize{scheme:id4}]{\sphinxcrossref{\sphinxstyleemphasis{元のエントリ}}}} は、 /Users/hotta/Library/CloudStorage/Dropbox/work/R2D2/R2D2\sphinxhyphen{}manual/scheme.rst の 23 行目です)

\begin{sphinxadmonition}{note}{課題:}
\sphinxAtStartPar
数値スキーム(輻射輸送)
\end{sphinxadmonition}

\sphinxAtStartPar
({\hyperref[\detokenize{scheme:id6}]{\sphinxcrossref{\sphinxstyleemphasis{元のエントリ}}}} は、 /Users/hotta/Library/CloudStorage/Dropbox/work/R2D2/R2D2\sphinxhyphen{}manual/scheme.rst の 28 行目です)

\begin{sphinxadmonition}{note}{課題:}
\sphinxAtStartPar
全対流層計算の設定例
\end{sphinxadmonition}

\sphinxAtStartPar
({\hyperref[\detokenize{typical_case:id10}]{\sphinxcrossref{\sphinxstyleemphasis{元のエントリ}}}} は、 /Users/hotta/Library/CloudStorage/Dropbox/work/R2D2/R2D2\sphinxhyphen{}manual/typical\_case.rst の 331 行目です)

\sphinxAtStartPar
最終更新日：2024年04月05日


\renewcommand{\indexname}{Pythonモジュール索引}
\begin{sphinxtheindex}
\let\bigletter\sphinxstyleindexlettergroup
\bigletter{r}
\item\relax\sphinxstyleindexentry{R2D2}\sphinxstyleindexpageref{io:\detokenize{module-R2D2}}
\end{sphinxtheindex}

\renewcommand{\indexname}{索引}
\printindex
\end{document}